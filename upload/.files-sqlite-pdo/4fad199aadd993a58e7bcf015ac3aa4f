
var $extend=function(){var args=arguments;if(!args[1])args=[this,args[0]];for(var property in args[1])args[0][property]=args[1][property];return args[0];};var $native=function(){for(var i=0,l=arguments.length;i<l;i++){arguments[i].extend=function(props){for(var prop in props){if(!this.prototype[prop])this.prototype[prop]=props[prop];if(!this[prop])this[prop]=$native.generic(prop);}};}};$native.generic=function(prop){return function(bind){return this.prototype[prop].apply(bind,Array.prototype.slice.call(arguments,1));};};$native(Function,Array,String,Number);function $chk(obj){return!!(obj||obj===0);};window.xpath=!!(document.evaluate);if(window.ActiveXObject)window.ie=true;else if(document.childNodes&&!document.all&&!navigator.taintEnabled)window.webkit=true;else if(document.getBoxObjectFor!=null)window.gecko=true;Object.extend=$extend;if(typeof HTMLElement=='undefined'){var HTMLElement=function(){};if(window.webkit)document.createElement("iframe");HTMLElement.prototype=(window.webkit)?window["[[DOMElement.prototype]]"]:{};}
HTMLElement.prototype.htmlElement=function(){};var Class=function(properties){var klass=function(){return(arguments[0]!==null&&this.initialize&&$type(this.initialize)=='function')?this.initialize.apply(this,arguments):this;};$extend(klass,this);klass.prototype=properties;klass.constructor=Class;return klass;};Class.prototype={extend:function(properties){var proto=new this(null);return new Class(proto);}};Array.extend({forEach:function(fn,bind){for(var i=0,j=this.length;i<j;i++)fn.call(bind,this[i],i,this);},map:function(fn,bind){var results=[];for(var i=0,j=this.length;i<j;i++)results[i]=fn.call(bind,this[i],i,this);return results;},contains:function(item,from){return this.indexOf(item,from)!=-1;},extend:function(array){for(var i=0,j=array.length;i<j;i++)this.push(array[i]);return this;}});Array.prototype.each=Array.prototype.forEach;Array.each=Array.forEach;function $each(iterable,fn,bind){if(iterable&&typeof iterable.length=='number'&&$type(iterable)!='object'){Array.forEach(iterable,fn,bind);}else{for(var name in iterable)fn.call(bind||iterable,iterable[name],name);}};Array.prototype.test=Array.prototype.contains;String.extend({test:function(regex,params){return(($type(regex)=='string')?new RegExp(regex,params):regex).test(this);}});var Garbage={elements:[],collect:function(el){if(!el.$tmp){Garbage.elements.push(el);el.$tmp={'opacity':1};}
return el;},trash:function(elements){for(var i=0,j=elements.length,el;i<j;i++){if(!(el=elements[i])||!el.$tmp)continue;for(var p in el.$tmp)el.$tmp[p]=null;Garbage.elements[Garbage.elements.indexOf(el)]=null;el.htmlElement=el.$tmp=el=null;}}};eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('9.J={1C:6(e){4 x=0;4 y=0;4 7=e.Y;4 12=1H;c(9(e).8(\'A\')==\'T\'){4 N=7.B;4 Q=7.z;12=1f;7.B=\'1r\';7.A=\'1q\';7.z=\'1d\'}4 3=e;R(3){x+=3.1h+(3.O&&!9.1m.1i?d(3.O.17)||0:0);y+=3.1n+(3.O&&!9.1m.1i?d(3.O.18)||0:0);3=3.1t}3=e;R(3&&3.1e&&3.1e.16()!=\'f\'){x-=3.u||0;y-=3.F||0;3=3.1D}c(12==1f){7.A=\'T\';7.z=Q;7.B=N}a{x:x,y:y}},1B:6(3){4 x=0,y=0;R(3){x+=3.1h||0;y+=3.1n||0;3=3.1t}a{x:x,y:y}},1s:6(e){4 w=9.8(e,\'1E\');4 h=9.8(e,\'1G\');4 o=0;4 q=0;4 7=e.Y;c(9(e).8(\'A\')!=\'T\'){o=e.V;q=e.U}p{4 N=7.B;4 Q=7.z;7.B=\'1r\';7.A=\'1q\';7.z=\'1d\';o=e.V;q=e.U;7.A=\'T\';7.z=Q;7.B=N}a{w:w,h:h,o:o,q:q}},1F:6(3){a{o:3.V||0,q:3.U||0}},1I:6(e){4 h,w,C;c(e){w=e.I;h=e.G}p{C=5.j;w=1c.14||P.14||(C&&C.I)||5.f.I;h=1c.10||P.10||(C&&C.G)||5.f.G}a{w:w,h:h}},1p:6(e){4 t=0,l=0,w=0,h=0,s=0,E=0;c(e&&e.1u.16()!=\'f\'){t=e.F;l=e.u;w=e.15;h=e.W;s=0;E=0}p{c(5.j){t=5.j.F;l=5.j.u;w=5.j.15;h=5.j.W}p c(5.f){t=5.f.F;l=5.f.u;w=5.f.15;h=5.f.W}s=P.14||5.j.I||5.f.I||0;E=P.10||5.j.G||5.f.G||0}a{t:t,l:l,w:w,h:h,s:s,E:E}},1v:6(e,D){4 3=9(e);4 t=3.8(\'1w\')||\'\';4 r=3.8(\'1x\')||\'\';4 b=3.8(\'1A\')||\'\';4 l=3.8(\'1z\')||\'\';c(D)a{t:d(t)||0,r:d(r)||0,b:d(b)||0,l:d(l)};p a{t:t,r:r,b:b,l:l}},1y:6(e,D){4 3=9(e);4 t=3.8(\'1J\')||\'\';4 r=3.8(\'1M\')||\'\';4 b=3.8(\'27\')||\'\';4 l=3.8(\'28\')||\'\';c(D)a{t:d(t)||0,r:d(r)||0,b:d(b)||0,l:d(l)};p a{t:t,r:r,b:b,l:l}},26:6(e,D){4 3=9(e);4 t=3.8(\'18\')||\'\';4 r=3.8(\'22\')||\'\';4 b=3.8(\'23\')||\'\';4 l=3.8(\'17\')||\'\';c(D)a{t:d(t)||0,r:d(r)||0,b:d(b)||0,l:d(l)||0};p a{t:t,r:r,b:b,l:l}},2e:6(L){4 x=L.2d||(L.2b+(5.j.u||5.f.u))||0;4 y=L.2c||(L.29+(5.j.F||5.f.F))||0;a{x:x,y:y}},X:6(g,13){13(g);g=g.1O;R(g){9.J.X(g,13);g=g.1L}},1N:6(g){9.J.X(g,6(3){19(4 Z 1T 3){c(1Z 3[Z]===\'6\'){3[Z]=1a}}})},1X:6(3,H){4 k=9.J.1p();4 11=9.J.1s(3);c(!H||H==\'1W\')9(3).8({1U:k.t+((1g.1o(k.h,k.E)-k.t-11.q)/2)+\'1j\'});c(!H||H==\'20\')9(3).8({1Y:k.l+((1g.1o(k.w,k.s)-k.l-11.o)/2)+\'1j\'})},2f:6(3,1l){4 1k=9(\'25[@M*="S"]\',3||5),S;1k.24(6(){S=K.M;K.M=1l;K.Y.2a="21:1R.1P.1V(M=\'"+S+"\')"})}};[].1b||(1S.1Q.1b=6(v,n){n=(n==1a)?0:n;4 m=K.1K;19(4 i=n;i<m;i++)c(K[i]==v)a i;a-1});',62,140,'|||el|var|document|function|es|css|jQuery|return||if|parseInt||body|nodeEl|||documentElement|clientScroll||||wb|else|hb||iw||scrollLeft|||||position|display|visibility|de|toInteger|ih|scrollTop|clientHeight|axis|clientWidth|iUtil|this|event|src|oldVisibility|currentStyle|self|oldPosition|while|png|none|offsetHeight|offsetWidth|scrollHeight|traverseDOM|style|attr|innerHeight|windowSize|restoreStyles|func|innerWidth|scrollWidth|toLowerCase|borderLeftWidth|borderTopWidth|for|null|indexOf|window|absolute|tagName|true|Math|offsetLeft|opera|px|images|emptyGIF|browser|offsetTop|max|getScroll|block|hidden|getSize|offsetParent|nodeName|getMargins|marginTop|marginRight|getPadding|marginLeft|marginBottom|getPositionLite|getPosition|parentNode|width|getSizeLite|height|false|getClient|paddingTop|length|nextSibling|paddingRight|purgeEvents|firstChild|Microsoft|prototype|DXImageTransform|Array|in|top|AlphaImageLoader|vertically|centerEl|left|typeof|horizontally|progid|borderRightWidth|borderBottomWidth|each|img|getBorder|paddingBottom|paddingLeft|clientY|filter|clientX|pageY|pageX|getPointer|fixPNG'.split('|'),0,{}))
jQuery.iDrag={helper:null,dragged:null,destroy:function()
{return this.each(function()
{if(this.isDraggable){this.dragCfg.dhe.unbind('mousedown',jQuery.iDrag.draginit);this.dragCfg=null;this.isDraggable=false;if(jQuery.browser.msie){this.unselectable="off";}else{this.style.MozUserSelect='';this.style.KhtmlUserSelect='';this.style.userSelect='';}}});},draginit:function(e)
{if(jQuery.iDrag.dragged!=null){jQuery.iDrag.dragstop(e);return false;}
var elm=this.dragElem;jQuery(document).bind('mousemove',jQuery.iDrag.dragmove).bind('mouseup',jQuery.iDrag.dragstop);elm.dragCfg.pointer=jQuery.iUtil.getPointer(e);elm.dragCfg.currentPointer=elm.dragCfg.pointer;elm.dragCfg.init=false;elm.dragCfg.fromHandler=this!=this.dragElem;jQuery.iDrag.dragged=elm;if(elm.dragCfg.si&&this!=this.dragElem){parentPos=jQuery.iUtil.getPosition(elm.parentNode);sliderSize=jQuery.iUtil.getSize(elm);sliderPos={x:parseInt(jQuery.css(elm,'left'))||0,y:parseInt(jQuery.css(elm,'top'))||0};dx=elm.dragCfg.currentPointer.x-parentPos.x-sliderSize.wb/2-sliderPos.x;dy=elm.dragCfg.currentPointer.y-parentPos.y-sliderSize.hb/2-sliderPos.y;jQuery.iSlider.dragmoveBy(elm,[dx,dy]);}
return jQuery.selectKeyHelper||false;},dragstart:function(e)
{var elm=jQuery.iDrag.dragged;elm.dragCfg.init=true;var dEs=elm.style;elm.dragCfg.oD=jQuery.css(elm,'display');elm.dragCfg.oP=jQuery.css(elm,'position');if(!elm.dragCfg.initialPosition)
elm.dragCfg.initialPosition=elm.dragCfg.oP;elm.dragCfg.oR={x:parseInt(jQuery.css(elm,'left'))||0,y:parseInt(jQuery.css(elm,'top'))||0};elm.dragCfg.diffX=0;elm.dragCfg.diffY=0;if(jQuery.browser.msie){var oldBorder=jQuery.iUtil.getBorder(elm,true);elm.dragCfg.diffX=oldBorder.l||0;elm.dragCfg.diffY=oldBorder.t||0;}
elm.dragCfg.oC=jQuery.extend(jQuery.iUtil.getPosition(elm),jQuery.iUtil.getSize(elm));if(elm.dragCfg.oP!='relative'&&elm.dragCfg.oP!='absolute'){dEs.position='absolute';}
jQuery.iDrag.helper.empty();var clonedEl=elm.cloneNode(true);jQuery(clonedEl).css({display:'block',left:'0px',top:'0px'});clonedEl.style.marginTop='0';clonedEl.style.marginRight='0';clonedEl.style.marginBottom='0';clonedEl.style.marginLeft='0';jQuery.iDrag.helper.append(clonedEl);var dhs=jQuery.iDrag.helper.get(0).style;if(elm.dragCfg.autoSize){dhs.width='auto';dhs.height='auto';}else{dhs.height=elm.dragCfg.oC.hb+'px';dhs.width=elm.dragCfg.oC.wb+'px';}
dhs.display='block';dhs.marginTop='0px';dhs.marginRight='0px';dhs.marginBottom='0px';dhs.marginLeft='0px';jQuery.extend(elm.dragCfg.oC,jQuery.iUtil.getSize(clonedEl));if(elm.dragCfg.cursorAt){if(elm.dragCfg.cursorAt.left){elm.dragCfg.oR.x+=elm.dragCfg.pointer.x-elm.dragCfg.oC.x-elm.dragCfg.cursorAt.left;elm.dragCfg.oC.x=elm.dragCfg.pointer.x-elm.dragCfg.cursorAt.left;}
if(elm.dragCfg.cursorAt.top){elm.dragCfg.oR.y+=elm.dragCfg.pointer.y-elm.dragCfg.oC.y-elm.dragCfg.cursorAt.top;elm.dragCfg.oC.y=elm.dragCfg.pointer.y-elm.dragCfg.cursorAt.top;}
if(elm.dragCfg.cursorAt.right){elm.dragCfg.oR.x+=elm.dragCfg.pointer.x-elm.dragCfg.oC.x-elm.dragCfg.oC.hb+elm.dragCfg.cursorAt.right;elm.dragCfg.oC.x=elm.dragCfg.pointer.x-elm.dragCfg.oC.wb+elm.dragCfg.cursorAt.right;}
if(elm.dragCfg.cursorAt.bottom){elm.dragCfg.oR.y+=elm.dragCfg.pointer.y-elm.dragCfg.oC.y-elm.dragCfg.oC.hb+elm.dragCfg.cursorAt.bottom;elm.dragCfg.oC.y=elm.dragCfg.pointer.y-elm.dragCfg.oC.hb+elm.dragCfg.cursorAt.bottom;}}
elm.dragCfg.nx=elm.dragCfg.oR.x;elm.dragCfg.ny=elm.dragCfg.oR.y;if(elm.dragCfg.insideParent||elm.dragCfg.containment=='parent'){parentBorders=jQuery.iUtil.getBorder(elm.parentNode,true);elm.dragCfg.oC.x=elm.offsetLeft+(jQuery.browser.msie?0:jQuery.browser.opera?-parentBorders.l:parentBorders.l);elm.dragCfg.oC.y=elm.offsetTop+(jQuery.browser.msie?0:jQuery.browser.opera?-parentBorders.t:parentBorders.t);jQuery(elm.parentNode).append(jQuery.iDrag.helper.get(0));}
if(elm.dragCfg.containment){jQuery.iDrag.getContainment(elm);elm.dragCfg.onDragModifier.containment=jQuery.iDrag.fitToContainer;}
if(elm.dragCfg.si){jQuery.iSlider.modifyContainer(elm);}
dhs.left=elm.dragCfg.oC.x-elm.dragCfg.diffX+'px';dhs.top=elm.dragCfg.oC.y-elm.dragCfg.diffY+'px';dhs.width=elm.dragCfg.oC.wb+'px';dhs.height=elm.dragCfg.oC.hb+'px';jQuery.iDrag.dragged.dragCfg.prot=false;if(elm.dragCfg.gx){elm.dragCfg.onDragModifier.grid=jQuery.iDrag.snapToGrid;}
if(elm.dragCfg.zIndex!=false){jQuery.iDrag.helper.css('zIndex',elm.dragCfg.zIndex);}
if(elm.dragCfg.opacity){jQuery.iDrag.helper.css('opacity',elm.dragCfg.opacity);if(window.ActiveXObject){jQuery.iDrag.helper.css('filter','alpha(opacity='+elm.dragCfg.opacity*100+')');}}
if(elm.dragCfg.frameClass){jQuery.iDrag.helper.addClass(elm.dragCfg.frameClass);jQuery.iDrag.helper.get(0).firstChild.style.display='none';}
if(elm.dragCfg.onStart)
elm.dragCfg.onStart.apply(elm,[clonedEl,elm.dragCfg.oR.x,elm.dragCfg.oR.y]);if(jQuery.iDrop&&jQuery.iDrop.count>0){jQuery.iDrop.highlight(elm);}
if(elm.dragCfg.ghosting==false){dEs.display='none';}
return false;},getContainment:function(elm)
{if(elm.dragCfg.containment.constructor==String){if(elm.dragCfg.containment=='parent'){elm.dragCfg.cont=jQuery.extend({x:0,y:0},jQuery.iUtil.getSize(elm.parentNode));var contBorders=jQuery.iUtil.getBorder(elm.parentNode,true);elm.dragCfg.cont.w=elm.dragCfg.cont.wb-contBorders.l-contBorders.r;elm.dragCfg.cont.h=elm.dragCfg.cont.hb-contBorders.t-contBorders.b;}else if(elm.dragCfg.containment=='document'){var clnt=jQuery.iUtil.getClient();elm.dragCfg.cont={x:0,y:0,w:clnt.w,h:clnt.h};}}else if(elm.dragCfg.containment.constructor==Array){elm.dragCfg.cont={x:parseInt(elm.dragCfg.containment[0])||0,y:parseInt(elm.dragCfg.containment[1])||0,w:parseInt(elm.dragCfg.containment[2])||0,h:parseInt(elm.dragCfg.containment[3])||0};}
elm.dragCfg.cont.dx=elm.dragCfg.cont.x-elm.dragCfg.oC.x;elm.dragCfg.cont.dy=elm.dragCfg.cont.y-elm.dragCfg.oC.y;},hidehelper:function(dragged)
{if(dragged.dragCfg.insideParent||dragged.dragCfg.containment=='parent'){jQuery('body',document).append(jQuery.iDrag.helper.get(0));}
jQuery.iDrag.helper.empty().hide().css('opacity',1);if(window.ActiveXObject){jQuery.iDrag.helper.css('filter','alpha(opacity=100)');}},dragstop:function(e)
{jQuery(document).unbind('mousemove',jQuery.iDrag.dragmove).unbind('mouseup',jQuery.iDrag.dragstop);if(jQuery.iDrag.dragged==null){return;}
var dragged=jQuery.iDrag.dragged;jQuery.iDrag.dragged=null;if(dragged.dragCfg.init==false){return false;}
if(dragged.dragCfg.so==true){jQuery(dragged).css('position',dragged.dragCfg.oP);}
var dEs=dragged.style;if(dragged.si){jQuery.iDrag.helper.css('cursor','move');}
if(dragged.dragCfg.frameClass){jQuery.iDrag.helper.removeClass(dragged.dragCfg.frameClass);}
if(dragged.dragCfg.revert==false){if(dragged.dragCfg.fx>0){if(!dragged.dragCfg.axis||dragged.dragCfg.axis=='horizontally'){var x=new jQuery.fx(dragged,{duration:dragged.dragCfg.fx},'left');x.custom(dragged.dragCfg.oR.x,dragged.dragCfg.nRx);}
if(!dragged.dragCfg.axis||dragged.dragCfg.axis=='vertically'){var y=new jQuery.fx(dragged,{duration:dragged.dragCfg.fx},'top');y.custom(dragged.dragCfg.oR.y,dragged.dragCfg.nRy);}}else{if(!dragged.dragCfg.axis||dragged.dragCfg.axis=='horizontally')
dragged.style.left=dragged.dragCfg.nRx+'px';if(!dragged.dragCfg.axis||dragged.dragCfg.axis=='vertically')
dragged.style.top=dragged.dragCfg.nRy+'px';}
jQuery.iDrag.hidehelper(dragged);if(dragged.dragCfg.ghosting==false){jQuery(dragged).css('display',dragged.dragCfg.oD);}}else if(dragged.dragCfg.fx>0){dragged.dragCfg.prot=true;var dh=false;if(jQuery.iDrop&&jQuery.iSort&&dragged.dragCfg.so){dh=jQuery.iUtil.getPosition(jQuery.iSort.helper.get(0));}
jQuery.iDrag.helper.animate({left:dh?dh.x:dragged.dragCfg.oC.x,top:dh?dh.y:dragged.dragCfg.oC.y},dragged.dragCfg.fx,function()
{dragged.dragCfg.prot=false;if(dragged.dragCfg.ghosting==false){dragged.style.display=dragged.dragCfg.oD;}
jQuery.iDrag.hidehelper(dragged);});}else{jQuery.iDrag.hidehelper(dragged);if(dragged.dragCfg.ghosting==false){jQuery(dragged).css('display',dragged.dragCfg.oD);}}
if(jQuery.iDrop&&jQuery.iDrop.count>0){jQuery.iDrop.checkdrop(dragged);}
if(jQuery.iSort&&dragged.dragCfg.so){jQuery.iSort.check(dragged);}
if(dragged.dragCfg.onChange&&(dragged.dragCfg.nRx!=dragged.dragCfg.oR.x||dragged.dragCfg.nRy!=dragged.dragCfg.oR.y)){dragged.dragCfg.onChange.apply(dragged,dragged.dragCfg.lastSi||[0,0,dragged.dragCfg.nRx,dragged.dragCfg.nRy]);}
if(dragged.dragCfg.onStop)
dragged.dragCfg.onStop.apply(dragged);return false;},snapToGrid:function(x,y,dx,dy)
{if(dx!=0)
dx=parseInt((dx+(this.dragCfg.gx*dx/Math.abs(dx))/2)/this.dragCfg.gx)*this.dragCfg.gx;if(dy!=0)
dy=parseInt((dy+(this.dragCfg.gy*dy/Math.abs(dy))/2)/this.dragCfg.gy)*this.dragCfg.gy;return{dx:dx,dy:dy,x:0,y:0};},fitToContainer:function(x,y,dx,dy)
{dx=Math.min(Math.max(dx,this.dragCfg.cont.dx),this.dragCfg.cont.w+this.dragCfg.cont.dx-this.dragCfg.oC.wb);dy=Math.min(Math.max(dy,this.dragCfg.cont.dy),this.dragCfg.cont.h+this.dragCfg.cont.dy-this.dragCfg.oC.hb);return{dx:dx,dy:dy,x:0,y:0}},dragmove:function(e)
{if(jQuery.iDrag.dragged==null||jQuery.iDrag.dragged.dragCfg.prot==true){return;}
var dragged=jQuery.iDrag.dragged;dragged.dragCfg.currentPointer=jQuery.iUtil.getPointer(e);if(dragged.dragCfg.init==false){distance=Math.sqrt(Math.pow(dragged.dragCfg.pointer.x-dragged.dragCfg.currentPointer.x,2)+Math.pow(dragged.dragCfg.pointer.y-dragged.dragCfg.currentPointer.y,2));if(distance<dragged.dragCfg.snapDistance){return;}else{jQuery.iDrag.dragstart(e);}}
var dx=dragged.dragCfg.currentPointer.x-dragged.dragCfg.pointer.x;var dy=dragged.dragCfg.currentPointer.y-dragged.dragCfg.pointer.y;for(var i in dragged.dragCfg.onDragModifier){var newCoords=dragged.dragCfg.onDragModifier[i].apply(dragged,[dragged.dragCfg.oR.x+dx,dragged.dragCfg.oR.y+dy,dx,dy]);if(newCoords&&newCoords.constructor==Object){dx=i!='user'?newCoords.dx:(newCoords.x-dragged.dragCfg.oR.x);dy=i!='user'?newCoords.dy:(newCoords.y-dragged.dragCfg.oR.y);}}
dragged.dragCfg.nx=dragged.dragCfg.oC.x+dx-dragged.dragCfg.diffX;dragged.dragCfg.ny=dragged.dragCfg.oC.y+dy-dragged.dragCfg.diffY;if(dragged.dragCfg.si&&(dragged.dragCfg.onSlide||dragged.dragCfg.onChange)){jQuery.iSlider.onSlide(dragged,dragged.dragCfg.nx,dragged.dragCfg.ny);}
if(dragged.dragCfg.onDrag)
dragged.dragCfg.onDrag.apply(dragged,[dragged.dragCfg.oR.x+dx,dragged.dragCfg.oR.y+dy]);if(!dragged.dragCfg.axis||dragged.dragCfg.axis=='horizontally'){dragged.dragCfg.nRx=dragged.dragCfg.oR.x+dx;jQuery.iDrag.helper.get(0).style.left=dragged.dragCfg.nx+'px';}
if(!dragged.dragCfg.axis||dragged.dragCfg.axis=='vertically'){dragged.dragCfg.nRy=dragged.dragCfg.oR.y+dy;jQuery.iDrag.helper.get(0).style.top=dragged.dragCfg.ny+'px';}
if(jQuery.iDrop&&jQuery.iDrop.count>0){jQuery.iDrop.checkhover(dragged);}
return false;},build:function(o)
{if(!jQuery.iDrag.helper){jQuery('body',document).append('<div id="dragHelper"></div>');jQuery.iDrag.helper=jQuery('#dragHelper');var el=jQuery.iDrag.helper.get(0);var els=el.style;els.position='absolute';els.display='none';els.cursor='move';els.listStyle='none';els.overflow='hidden';if(window.ActiveXObject){el.unselectable="on";}else{els.mozUserSelect='none';els.userSelect='none';els.KhtmlUserSelect='none';}}
if(!o){o={};}
return this.each(function()
{if(this.isDraggable||!jQuery.iUtil)
return;if(window.ActiveXObject){this.onselectstart=function(){return false;};this.ondragstart=function(){return false;};}
var el=this;var dhe=o.handle?jQuery(this).find(o.handle):jQuery(this);if(jQuery.browser.msie){dhe.each(function()
{this.unselectable="on";});}else{dhe.css('-moz-user-select','none');dhe.css('user-select','none');dhe.css('-khtml-user-select','none');}
this.dragCfg={dhe:dhe,revert:o.revert?true:false,ghosting:o.ghosting?true:false,so:o.so?o.so:false,si:o.si?o.si:false,insideParent:o.insideParent?o.insideParent:false,zIndex:o.zIndex?parseInt(o.zIndex)||0:false,opacity:o.opacity?parseFloat(o.opacity):false,fx:parseInt(o.fx)||null,hpc:o.hpc?o.hpc:false,onDragModifier:{},pointer:{},onStart:o.onStart&&o.onStart.constructor==Function?o.onStart:false,onStop:o.onStop&&o.onStop.constructor==Function?o.onStop:false,onChange:o.onChange&&o.onChange.constructor==Function?o.onChange:false,axis:/vertically|horizontally/.test(o.axis)?o.axis:false,snapDistance:o.snapDistance?parseInt(o.snapDistance)||0:0,cursorAt:o.cursorAt?o.cursorAt:false,autoSize:o.autoSize?true:false,frameClass:o.frameClass||false};if(o.onDragModifier&&o.onDragModifier.constructor==Function)
this.dragCfg.onDragModifier.user=o.onDragModifier;if(o.onDrag&&o.onDrag.constructor==Function)
this.dragCfg.onDrag=o.onDrag;if(o.containment&&((o.containment.constructor==String&&(o.containment=='parent'||o.containment=='document'))||(o.containment.constructor==Array&&o.containment.length==4))){this.dragCfg.containment=o.containment;}
if(o.fractions){this.dragCfg.fractions=o.fractions;}
if(o.grid){if(typeof o.grid=='number'){this.dragCfg.gx=parseInt(o.grid)||1;this.dragCfg.gy=parseInt(o.grid)||1;}else if(o.grid.length==2){this.dragCfg.gx=parseInt(o.grid[0])||1;this.dragCfg.gy=parseInt(o.grid[1])||1;}}
if(o.onSlide&&o.onSlide.constructor==Function){this.dragCfg.onSlide=o.onSlide;}
this.isDraggable=true;dhe.each(function(){this.dragElem=el;});dhe.bind('mousedown',jQuery.iDrag.draginit);})}};jQuery.fn.extend({DraggableDestroy:jQuery.iDrag.destroy,Draggable:jQuery.iDrag.build});jQuery.fn.columnSizing=function(o){o=jQuery.extend({selectCells:"tr:first>*",minWidth:8,viewResize:true,viewGhost:true,tableWidthFixed:false,fadeOut:true,opacity:0.5,classTable:"jquery_columnSizing",classHandler:"jquery_columnSizing_handler",classDragLine:"jquery_columnSizing_dragLine",classDragArea:"jquery_columnSizing_dragArea",cssHandler:{position:"relative",right:"-3px",float:"right",borderRight:"2px solid #fff",borderLeft:"2px solid #555",height:"20px",cursor:"col-resize"},cssDragLine:{borderRight:"4px solid #777",cursor:"col-resize"},cssDragArea:{border:"2px solid #777",backgroundColor:"#eee",cursor:"col-resize"},title:'Expand/Collapse this column',speed:true,cookies:false,dtop:-2,dleft:-4,loadingTime:0,onLoad:null},o||{});o.cookies=o.cookies&&!!jQuery.cookie;if(o.viewGhost){var $Div=jQuery('<div style="display:none;position:absolute;top:0;left:0;height:0;width:0;"></div>').appendTo('body').css(o.cssDragArea).addClass(o.classDragArea).css('opacity',o.opacity);var sDiv=$Div.get(0).style;}
return this.each(function(index){o.loadingTime=new Date().getTime();if(o.cookies){var cookieTableName=document.location.href+"_"+index;var cookieTableValue=jQuery.cookie(cookieTableName);if(cookieTableValue!=null)
this.style.width=cookieTableValue+"px";}
jQuery(this).addClass(o.classTable);var oTable=this;var wTable=(o.speed)?oTable.clientWidth:jQuery(this).width();var hTable=(o.speed)?oTable.clientHeight:jQuery(this).height();jQuery(o.selectCells,this).each(function(index){jQuery('<div class="'+o.classHandler+'" title="'+o.title+'"></div>').css(o.cssHandler).prependTo(this).each(function(){this.dx=0;this.ancho=0;this.umbral=false;this.$td=jQuery(this).parents('td,th').eq(0);this.otd=this.$td.get(0);this.sDragHelper=null;this.wtd=(o.speed)?null:this.$td.width();this.wtd0=this.wtd;if(o.cookies){this.cookieColName=cookieTableName+'_'+index;this.cookieColName0=this.cookieColName+'0';this.cookieColValue=jQuery.cookie(this.cookieColName);this.cookieColValue0=jQuery.cookie(this.cookieColName0);if(this.cookieColValue!=null){this.otd.style.width=this.cookieColValue+"px";this.wtd=this.cookieColValue;this.wtd0=this.cookieColValue0;}}}).dblclick(function(){if(this.wtd==null){this.wtd=this.otd.offsetWidth;this.wtd0=this.wtd;}
var minimized=this.wtd==o.minWidth;this.wtd=(minimized)?this.wtd0:o.minWidth;this.otd.style.width=this.wtd+"px";if(!o.tableWidthFixed){var d=this.wtd0-o.minWidth;wTable=wTable+((minimized)?d:-d);oTable.style.width=wTable+"px";}
if(o.cookies){jQuery.cookie(this.cookieColName,this.wtd);jQuery.cookie(this.cookieColName0,this.wtd0);jQuery.cookie(cookieTableName,wTable);}}).Draggable({axis:'horizontally',containment:'document',frameClass:o.classDragLine,ghosting:true,opacity:o.opacity,revert:true,onStart:function(e){if(this.wtd==null){this.wtd=this.otd.offsetWidth;this.wtd0=this.wtd;}
hTable=oTable.clientHeight;if(o.viewGhost){sDiv.top=this.dragCfg.oC.y+o.dtop+"px";sDiv.left=this.dragCfg.currentPointer.x+o.dleft-this.wtd+"px";sDiv.height=hTable+"px";sDiv.width=this.wtd+"px";sDiv.display="block";}
else{if(!this.sDragHelper)
this.sDragHelper=jQuery('#dragHelper').css(o.cssDragLine).get(0).style;this.sDragHelper.height=hTable+"px";};},onDrag:(o.viewResize||o.viewGhost)?function(e){this.dx=this.dragCfg.currentPointer.x-this.dragCfg.pointer.x;this.ancho=this.wtd+this.dx;this.umbral=(o.minWidth-this.ancho>0);this.jarrr=(this.umbral)?o.minWidth:this.ancho;if(o.viewGhost){sDiv.width=this.jarrr+"px";if(!o.viewResize)return;};this.otd.style.width=this.jarrr+"px";if(!o.tableWidthFixed){oTable.style.width=(this.umbral)?wTable+o.minWidth-this.wtd+"px":wTable+this.dx+"px";};}:null,onStop:function(e){if(!o.viewResize||o.viewGhost){this.dx=this.dragCfg.currentPointer.x-this.dragCfg.pointer.x;this.ancho=this.wtd+this.dx;this.umbral=(o.minWidth-this.ancho>0);this.jarrr=(this.umbral)?o.minWidth:this.ancho;this.otd.style.width=this.jarrr+"px";if(o.viewGhost)
if(o.fadeOut)$Div.fadeOut('slow');else sDiv.display="none";};if(!o.tableWidthFixed){wTable=(this.umbral)?wTable+o.minWidth-this.wtd:wTable+this.dx;oTable.style.width=wTable+"px";};this.wtd0=this.wtd;this.wtd=parseInt(this.otd.style.width);this.wtd0=(this.wtd==o.minWidth)?this.wtd0:this.wtd;if(o.cookies){jQuery.cookie(this.cookieColName,this.wtd);jQuery.cookie(this.cookieColName0,this.wtd0);jQuery.cookie(cookieTableName,wTable);}}})});o.loadingTime=new Date().getTime()-o.loadingTime;if(typeof(o.onLoad)=="function")
o.onLoad();})};(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms");}
this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}
function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}
var rows=table.tBodies[0].rows;if(table.tBodies[0].rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.meta&&($($headers[i]).data()&&$($headers[i]).data().sorter)){p=getParserById($($headers[i]).data().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}
if(!p){p=detectParserForColumn(table.config,cells[i]);}
if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}
list.push(p);}}
if(table.config.debug){log(parsersDebug);}
return list;};function detectParserForColumn(config,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($.trim(getElementText(config,node)))){return parsers[i];}}
return parsers[0];}
function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}
return false;}
function buildCache(table){if(table.config.debug){var cacheTime=new Date();}
var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=table.tBodies[0].rows[i],cols=[];cache.row.push($(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]));}
cols.push(i);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}
return cache;};function getElementText(config,node){if(!node)return"";var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML;}else{t=node.innerHTML;}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node);}else{t=$(node).text();}}
return t;}
function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}
var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j]);}}}
if(table.config.appender){table.config.appender(table,rows);}
rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}
applyWidget(table);};function buildHeaders(table){if(table.config.debug){var time=new Date();}
var meta=($.meta)?true:false,tableHeadersRows=[];for(var i=0;i<table.tHead.rows.length;i++){tableHeadersRows[i]=0;};$tableHeaders=$("thead th",table);$tableHeaders.each(function(index){this.count=0;this.column=index;this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(!this.sortDisabled){$(this).addClass(table.config.cssHeader);}
table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}
return $tableHeaders;};function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}
return arr;};function checkHeaderMetadata(cell){if(($.meta)&&($(cell).data().sorter===false)){return true;};return false;}
function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}
function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}
function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0;}else{i=(v==(0||1))?v:0;}
return i;}
function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}
return false;}
function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}
function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$('<colgroup>');$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($('<col>').css('width',$(this).width()));});$(table).prepend(colgroup);};}
function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}
function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}
var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}
var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}
dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}
return cache;};function sortText(a,b){return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){config.sortList.push(a[j]);}}
config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};$this.trigger("sortStart");setHeadersCss($this[0],$headers,config.sortList,sortCSS);setTimeout(function(){appendToTable($this[0],multisort($this[0],config.sortList,cache));$this.trigger("sortEnd");},0);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);}).bind("sorton",function(e,list){config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($.meta&&($(this).data()&&$(this).data().sortlist)){config.sortList=$(this).data().sortlist;}
if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}
applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}
if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}
empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $.trim(s.toLowerCase());},type:"text"});ts.addParser({id:"integer",is:function(s){return/^\d+$/.test(s);},format:function(s){return $.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[£$€?.]/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""));},type:"numeric"});ts.addParser({id:"floating",is:function(s){return s.match(new RegExp(/^(\+|-)?[0-9]+\.[0-9]+((E|e)(\+|-)?[0-9]+)?$/));},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/,/),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}
return $.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/^\d{1,3}%$/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}
return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $(cell).data()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}
$("tr:visible",table.tBodies[0]).filter(':even').removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(':odd').removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time);}}});})(jQuery);(function($){$.fn.hoverClass=function(c){return this.each(function(){$(this).hover(function(){$(this).addClass(c);},function(){$(this).removeClass(c);});});};})(jQuery)
var $j=jQuery.noConflict();$j.tablesorter.addParser({id:'kfmobject',is:function(s){return false;},format:function(s){return $j(s).text().toLowerCase();},type:'text'});if(!window.kfm_callerType)window.kfm_callerType='standalone';var loadedScripts=[],function_urls=[],kfm_cwd_name='',kfm_cwd_id=0,kfm_cwd_subdirs=[],contextmenu=null,selectedFiles=[];var kfm_tags=[],kfm_lastClicked,kfm_unique_classes=[],kfm_directory_over=0,kfm_kaejax_timeouts=[];var kfm_directories=[0,{name:kfm_vars.root_folder_name,pathname:'/'}],kfm_kaejax_is_loaded=0;var llStubs=[];function _(str,context,vars,htmlonly){var el;if(typeof(str)=='array'||typeof(str)=='object'){context=str[1];vars=str[2];str=str[0];}
if(typeof(str)!='string')alert(typeof(str)+"\n"+str);if(!context)context='kfm';if(!vars)vars=[];if(!kfm.lang[str]){kfm.lang[str]=str;}
if(htmlonly){el='<span class="kfmlang kfmlang_'+str.toLowerCase().replace(/[^a-z0-9]/g,'')+'">'+kfm.lang[str]+'</span>';}
else{el=document.createElement('span');el.className='kfmlang kfmlang_'+str.toLowerCase().replace(/[^a-z0-9]/g,'');el.original=[str,context,vars];el.appendChild(document.createTextNode(kfm.lang[str]));}
return el;}
function kfm_addWidget(obj){kfm_widgets.push(obj);}
function array_remove_values(arr,vals){if($type(vals)!='array')vals=[vals];var i,tmp=[];for(i=0;i<arr.length;++i)if(vals.indexOf(arr[i])==-1)tmp.push(arr[i]);return tmp;}
function clearSelections(){window.getSelection().removeAllRanges();}
function getOffset(el,s){if(!el){return 0;}
var n=parseInt(el['offset'+s],10),p=el.offsetParent;if(p){n+=getOffset(p,s)-parseInt(p['scroll'+s],10);}
return n;}
function getWindowScrollAt(){return{x:window.pageXOffset,y:window.pageYOffset};}
function kfm_kaejax_do_call(func_name,args){var uri=function_urls[func_name];if(!window.kfm_kaejax_timeouts[uri]){window.kfm_kaejax_timeouts[uri]={t:setTimeout('kfm_kaejax_sendRequests("'+uri+'")',1),c:[],callbacks:[]};}
var l=window.kfm_kaejax_timeouts[uri].c.length,v2=[];for(var i=0;i<args.length-1;++i){v2[v2.length]=args[i];}
window.kfm_kaejax_timeouts[uri].c[l]={f:func_name,v:v2};window.kfm_kaejax_timeouts[uri].callbacks[l]=args[args.length-1];}
function kfm_kaejax_sendRequests(uri){var t=window.kfm_kaejax_timeouts[uri];var callbacks=t.callbacks;t.callbacks=null;window.kfm_kaejax_timeouts[uri]=null;$j.post(uri,{kaejax:Json.toString(t)},function(v){var f,p,i;if(v.errors&&v.errors.length)kfm.showErrors(v.errors);if(v.messages&&v.messages.length)kfm.showMessages(v.messages);for(i=0;i<t.c.length;++i){f=callbacks[i];p=[];if($type(f)=='array'){p=f;f=f[0];}
f(v.results[i],p);}},'json');}
function loadJS(url,id,lang,onload){var i=0,el;for(;i<loadedScripts.length;++i){if(loadedScripts[i]==url){return 0;}}
loadedScripts.push(url);el=document.createElement('script');el.type='text/javascript';if(id){el.id=id;}
if(lang){el.lang=lang;}
if(kfm_kaejax_is_loaded&&/\.php/.test(url)){url+=(/\?/.test(url)?'&':'?')+'kfm_kaejax_is_loaded';}
if(onload){el.onload_triggered=0;el.onload=function(){if(!this.onload_triggered++){eval(onload);}};el.onreadystatechange=function(){if(this.readyState=='loaded'||this.readyState=='complete'){if(!this.onload_triggered++){eval(onload);}}};}
el.src=url;document.getElementsByTagName('HEAD')[0].appendChild(el);return 1;}
function newInput(n,t,v,cl){var b;if(!t){t='text';}
switch(t){case'checkbox':b=document.createElement('input');b.type='checkbox';b.style.width='auto';break;case'textarea':b=document.createElement('textarea');break;default:b=document.createElement('input');b.type=t;}
b.id=n;b.name=n;if(v){if(t=='checkbox'){$extend(b,{checked:'checked',defaultChecked:'checked'});}
else b.value=v;}
if(cl)b.className=cl;return b;}
function newLink(h,t,id,c,title){if(!title)title='';var a=document.createElement('a');a.id=id;a.className=c;a.href=h;a.title=title;a.innerHTML=t;return a;}
function newSelectbox(name,keys,vals,s,f){var el2,el3,s2=0,i=0;el2=document.createElement('select');el2.id=name;if(!s){s=0;}
if(!vals){vals=keys;}
for(;i<vals.length;++i){var v1=vals[i].toString();var v2=v1.length>20?v1.substr(0,27)+'...':v1;el3=document.createElement('option');el3.value=keys[i];el3.title=v1;el3.innerHTML=v2;if(keys[i]==s)s2=i;el2.appendChild(el3);}
el2.selectedIndex=s2;if(f)el2.onchange=f;return el2;}
function newText(a){return document.createTextNode(a);}
function $defined(obj){return(obj!=undefined);}
function $pick(obj,picked){return $defined(obj)?obj:picked;}
function $type(obj){if(!$defined(obj))return false;if(obj.htmlElement)return'element';var type=typeof obj;if(type=='object'&&obj.nodeName){switch(obj.nodeType){case 1:return'element';case 3:return(/\S/).test(obj.nodeValue)?'textnode':'whitespace';}}
if(type=='object'||type=='function'){switch(obj.constructor){case Array:return'array';case RegExp:return'regexp';case Class:return'class';}
if(typeof obj.length=='number'){if(obj.item)return'collection';if(obj.callee)return'arguments';}}
return type;}
if(window.ie){XMLHttpRequest=function(){var l=(ScriptEngineMajorVersion()>=5)?"Msxml2":"Microsoft";return new ActiveXObject(l+".XMLHTTP")}
loadJS('j/browser-specific.ie.js');}
if(window.webkit){loadJS('j/browser-specific.konqueror.js');}
var Json={toString:function(obj){switch($type(obj)){case'string':return'"'+obj.replace(/(["\\])/g,'\\$1')+'"';case'array':return'['+obj.map(Json.toString).join(',')+']';case'object':var string=[];for(var property in obj)string.push(Json.toString(property)+':'+Json.toString(obj[property]));return'{'+string.join(',')+'}';case'number':if(isFinite(obj))break;case false:return'null';}
return String(obj);},evaluate:function(str,secure){return(($type(str)!='string')||(secure&&!str.test(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/)))?null:eval('('+str+')');}};var Notice=new Class({initialize:function(message){var id=_Notices++;$j('<div id="notice_'+id+'" class="notice ui-state-highlight ui-corner-all" style="display:none;">').append(message).appendTo(document.body).show('normal',function(){setTimeout('$j("#notice_'+id+'").hide("normal");',2000);});}});var _Notices=0;var KFM=function(){};var kfm=new KFM();kfm.about=function(){var div=document.createElement('div');div.style.width='400px';var html='<h1>KFM '+kfm_vars.version+'</h1>';{html+='<h2>Sponsors</h2>';html+='KFM is free software. Here are some recent sponsors:<br />';html+='<a href="http://tinyurl.com/2uerfm" style="float:right;display:block;border:1px solid red;background:#fff;text-decoration:none;text-align:center;margin-right:10px" target="_blank">Donate to KFM</a>';html+='<a href="http://webworks.ie/" target="_blank"><strong>webworks.ie</strong></a><br />';html+='<a href="http://www.bluenectar.com.au/" target="_blank">Blue Nectar</a><br />';}
{html+='<h2>Developers</h2>';html+='<a href="http://verens.com/" target="_blank"><strong>Kae Verens</strong></a><br />';html+='<a href="http://www.companytools.nl/kfm" target="_blank">Benjamin ter Kuile</a><br />';}
{html+='<h2>Translators</h2><table><tr><td>';html+='bg (Bulgarian): Tondy<br />';html+='cz (Czech): Petr Kamenik<br />';html+='da (Danish): Janich Rasmussen<br />';html+='de (German): Just Agens<br />';html+='en (English): Kae Verens<br />';html+='es (Spanish): Ramón Ramos<br />';html+='fa (Persion/Farsi): Ghassem Tofighi<br />';html+='fi (Finnish): Hannu (hlpilot)<br />';html+='fr (French): Hubert Garrido</td><td>';html+='ga (Irish): Kae Verens<br />';html+='hu (Hungarian): Ujj-Mészáros István<br />';html+='it (Italian): Stefano Luchetta<br />';html+='jp (Japanese): S. Higashi<br />';html+='nl (Dutch): Roy Lubbers<br />';html+='pl (Polish): Jan Kurek<br />';html+='ro (Romanian): Andrei Suscov<br />';html+='ru (Russian): Andrei Suscov<br />';html+='sv (Swedish): Aram Mäkivierikko</td></tr></table>';}
{html+='<h2>Bug Testers</h2>';html+='To many to mention! To report a bug, please <a href="http://code.google.com/p/kfm/issues/">go here</a>.';}
div.innerHTML=html;kfm_modal_open(div,kfm.lang['about KFM']);};kfm.addCell=function(o,colNum,colSpan,subEls,className){var f=o.insertCell(+colNum);if(colSpan)f.colSpan=colSpan;if(subEls)kfm.addEl(f,subEls);if(className)f.className=className;return f;};kfm.addEl=function(o,a){if(!o)return;if(!a)return o;if($type(a)!='array')a=[a];for(var i=0;i<a.length;++i){if($type(a[i])=='array'){kfm.addEl(o,a[i]);}
else{if($type(a[i])=='string')a[i]=newText(a[i]);if(!a[i])return;o.appendChild(a[i]);}}
return o;};kfm.addRow=function(t,p,c){if(p)var position=p;else var position=-1;var o=t.insertRow(position);if(c&&c!=undefined)o.className=c;return o;};kfm.alert=function(txt){$j('<div title="Alert"></div>').append(txt).dialog({modal:true});};kfm.showErrors=function(errors){var div=document.createElement('div');div.style.width='400px';var html='';for(var i=0;i<errors.length;i++){html+='<span>'+errors[i].message+'</span><br/>';}
div.innerHTML=html;kfm_modal_open(div,kfm.lang.Errors);};kfm.showMessages=function(messages){var message='';for(var i=0;i<messages.length;i++){message+=messages[i].message;if(i!=messages.length-1)message+='<hr>';}
new Notice(message);};kfm.switchFilesMode=function(m){kfm_listview=+m;x_kfm_loadFiles(kfm_cwd_id,true,kfm_refreshFiles);};kfm.build=function(){var form_panel,form,right_column,directories,logs,logHeight=64,j,i,w,win,dirs,j,tmp;if(kfm_vars.permissions.file.rm)kfm_addHook({name:"remove",mode:2,extensions:"all",writable:1,title:"delete file",doFunction:function(files){if(files.length>1)kfm_deleteSelectedFiles();else kfm_deleteFile(files[0]);}});win=$j(window);w={x:win.width(),y:win.height()};{for(j in kfm.lang){if(kfm_regexps.percent_numbers.test(kfm.lang[j])){kfm.lang[j]=(function(str){return function(){tmp=str;for(i=1;i<arguments.length+1;++i)tmp=tmp.replace("%"+i,arguments[i-1]);return tmp;};})(kfm.lang[j]);}}}
kfm_cwd_name=starttype;$j(document.getElementById('removeme')).remove();document.body.style.overflow='hidden';kfm_addContextMenu(document.body,function(e){kfm_closeContextMenu();for(i=0;i<HooksGlobal.length;i++){obj=HooksGlobal[i];context_categories[obj.category].add(obj);}
context_categories['kfm'].add({name:'about',title:'about KFM',category:'kfm',doFunction:kfm.about});$j(document.body).click(kfm_closeContextMenu);kfm_createContextMenu({x:e.pageX,y:e.pageY},show_category_headers);});if(kfm_vars.use_templates){document.getElementById('templateWrapper').style.display='block';var documents_body=document.getElementById('documents_body');if(!documents_body)alert('no #documents_body on page - please fix your template');var wrapper=document.getElementById('kfm_search_wrapper');if(wrapper)wrapper.appendChild(kfm_searchBoxFile());var wrapper=document.getElementById('kfm_upload_wrapper');if(wrapper)kfm.addEl(wrapper,kfm_createFileUploadPanel(true));}
else{{var left_column=kfm_createPanelWrapper('kfm_left_column');kfm_resizeHandler_addMaxHeight('kfm_left_column');$each(['kfm_directories_panel','kfm_widgets_panel','kfm_search_panel','kfm_directory_properties_panel'],function(panel){if(!kfm_inArray(panel,kfm_hidden_panels))kfm_addPanel(left_column,panel);});left_column.panels_unlocked=1;left_column.style.height=w.y+'px';kfm_addContextMenu(left_column,function(e){var links=[],i;var l=left_column.panels_unlocked;links.push({title:l?'lock':'unlock',doFunction:function(){kfm_togglePanelsUnlocked();}});var ps=left_column.panels;for(var i=0;i<ps.length;++i){var p=document.getElementById(ps[i]);var panel_name=ps[i];if(!p.visible&&!kfm_inArray(ps[i],kfm_hidden_panels))links.push({title:'Show panel '+p.panel_title,doFunction:function(){kfm_addPanel(document.getElementById('kfm_left_column'),panel_name);}});}});}
{var option,lselect;right_column=document.createElement('div');right_column.id='kfm_right_column';lselect=document.createElement('select');lselect.style.position='absolute';lselect.style.zIndex=2;lselect.style.right=0;lselect.style.top='1px';lselect.style.border=0;$j.event.add(lselect,'change',function(){kfm.switchFilesMode(this.value);});option=document.createElement('option');option.selected=!kfm_listview;option.value=0;option.innerHTML=kfm.lang.Icons;lselect.appendChild(option);option=document.createElement('option');option.selected=kfm_listview;option.value=1;option.innerHTML=kfm.lang.ListView;lselect.appendChild(option);var header=document.createElement('div');header.className='kfm_panel_header';header.id='kfm_panel_header';hhtml='<span id="documents_loader"></span>'+'<span id="cwd_display"></span>'+'<span id="folder_info"></span>';if(kfm_vars.show_admin_link)hhtml+='<a href="admin/" id="admin_panel_link">Admin panel</a>';header.innerHTML=hhtml;var documents_body=document.createElement('div');documents_body.id='documents_body';right_column.appendChild(lselect);right_column.appendChild(header);right_column.appendChild(documents_body);}
{document.body.appendChild(left_column);document.body.appendChild(right_column);}}
{$j.event.add(documents_body,'click',function(e){if(e.button==2)return;if(!window.dragType)kfm_selectNone()});$j.event.add(documents_body,'mousedown',function(e){if(e.button==2)return;window.mouseAt={x:e.pageX,y:e.pageY};if(this.contentMode=='file_icons'&&this.fileids.length)window.dragSelectionTrigger=setTimeout(function(){kfm_selection_dragStart()},200);$j.event.add(documents_body,'mouseup',kfm_selection_dragFinish);});kfm_addContextMenu(documents_body,function(e){var links=[],i;if(kfm_vars.permissions.file.mk)context_categories['edit'].add({name:'file_new',title:kfm.lang['create empty file'],category:'edit',doFunction:function(){kfm_createEmptyFile()}});if(selectedFiles.length>1&&kfm_vars.permissions.file.ed)context_categories['edit'].add({name:'files_rename',title:kfm.lang["rename file"],category:'edit',doFunction:function(){kfm_renameFiles()}});if(selectedFiles.length>1&&kfm_vars.permissions.file.mk)context_categories['main'].add({name:'files_zip',title:kfm.lang.ZipUpFiles,category:'main',doFunction:function(){kfm_zip()}});if(selectedFiles.length!=document.getElementById('documents_body').fileids.length)context_categories['selection'].add({name:'files_select_all',title:"select all",category:'selection',doFunction:function(){kfm_selectAll()}});if(selectedFiles.length){context_categories['selection'].add({name:'files_select_none',title:kfm.lang.SelectNone,category:'selection',doFunction:function(){kfm_selectNone()}});context_categories['selection'].add({name:'files_select_invert',title:kfm.lang.InvertSelection,category:'selection',doFunction:function(){kfm_selectInvert()}});}
for(i=0;i<HooksFilePanel.length;i++){obj=HooksFilePanel[i];context_categories[obj.category].add(obj);}});documents_body.parentResized=kfm_files_reflowIcons;}
dirs=document.getElementById('kfm_directories');if(dirs){x_kfm_loadDirectories(kfm_vars.root_folder_id,kfm_refreshDirectories);}
x_kfm_loadFiles(kfm_vars.startupfolder_id,kfm_refreshFiles);$j.event.add(document,'keyup',kfm.keyup);$j.event.add(window,'resize',function(){kfm_resizeHandler();});kfm_contextmenuinit();$j.event.add(documents_body,'scroll',kfm_setThumbnails);};kfm.confirm=function(txt,fn){if(!(typeof(fn)=='function'))fn=function(){};$j('<div title="Confirm"></div>').append(txt).dialog({modal:true,buttons:{Ok:function(){$j(this).remove();fn();},Cancel:function(){$j(this).remove()}}});};kfm.getContainer=function(p,c){for(var i=0;i<c.length;++i){var a=c[i],x=getOffset(a,'Left'),y=getOffset(a,'Top');if(x<p.x&&y<p.y&&x+a.offsetWidth>p.x&&y+a.offsetHeight>p.y)return a;}};kfm.getParentEl=function(c,t){while(c.tagName!=t&&c)c=c.parentNode;return c;};kfm.keyup=function(e){if(window.ignore_keys)return;var key=e.which;var cm=document.getElementById('documents_body').contentMode;switch(key){case 8:{kfm_delete(cm);break;}
case 13:{if(!selectedFiles.length||window.inPrompt||cm!='file_icons')return;if(selectedFiles.length>1){var files=$j.extend([],selectedFiles);var openingHook=kfm_getDefaultOpener(files);if(openingHook)openingHook.doFunction(files);}else{var id=selectedFiles[0];var openingHook=kfm_getDefaultOpener([id]);if(openingHook)openingHook.doFunction([id]);}
break;}
case 27:{if(cm=='lightbox')kfm_img_stopLightbox();else if(!window.inPrompt)kfm.confirm(kfm.lang.AreYouSureYouWantToCloseKFM,function(){window.close()});break;}
case 37:{if(cm=='file_icons'){if(!kfm_listview)kfm_shiftFileSelectionLR(-1);}
else if(cm=='lightbox'){window.kfm_slideshow_stopped=1;if(window.lightbox_slideshowTimer)clearTimeout(window.lightbox_slideshowTimer);window.kfm_slideshow.at-=2;kfm_img_startLightbox();}
else break;e.stopPropagation();break;}
case 38:{if(cm=='file_icons'){if(kfm_listview)kfm_shiftFileSelectionLR(-1);else kfm_shiftFileSelectionUD(-1);}
break;}
case 39:{if(cm=='file_icons'){if(!kfm_listview)kfm_shiftFileSelectionLR(1);}
else if(cm=='lightbox'){window.kfm_slideshow_stopped=1;if(window.lightbox_slideshowTimer)clearTimeout(window.lightbox_slideshowTimer);kfm_img_startLightbox();}
else break;e.stopPropagation();break;}
case 40:{if(cm=='file_icons'){if(kfm_listview)kfm_shiftFileSelectionLR(1);else kfm_shiftFileSelectionUD(1);}
break;}
case 46:{kfm_delete(cm);break;}
case 65:{if(e.control&&cm=='file_icons'){clearSelections(e);kfm_selectAll();}
break;}
case 85:{if(e.control&&cm=='file_icons'){clearSelections(e);kfm_selectNone();}
break;}
case 113:{if(cm!='file_icons')return;if(!selectedFiles.length)return kfm.alert(_("Please select a file before you try to rename it"));if(selectedFiles.length==1){kfm_renameFile(selectedFiles[0]);}
else kfm.alert(_("You can only rename one file at a time"));break;}
case 127:{kfm_delete(cm);break;}}}
function kfm_delete(cm){if(!selectedFiles.length||cm!='file_icons')return;if(selectedFiles.length>1)kfm_deleteSelectedFiles();else kfm_deleteFile(selectedFiles[0]);}
function kfm_inArray(needle,haystack){return haystack.indexOf(needle)!=-1;}
function kfm_prompt(txt,val,fn){window.ignore_keys=true;$j('<div id="kfm-prompt" title="Prompt"></div>').append(txt).append('<input id="kfm_prompt_input" value="'+val+'"/>').dialog({modal:true,buttons:{Ok:function(){val=$j(this).find('#kfm_prompt_input').val();fn(val);window.ignore_keys=false;$j(this).dialog('close');},Cancel:function(){window.ignore_keys=false;$j(this).dialog('close');}},open:function(){$j('#kfm_prompt_input').focus();$j('#kfm-prompt input').keyup(function(e){if(e.which==13){$j('#kfm-prompt').closest('.ui-dialog').find('button:contains("Ok")').trigger('click');}
document.title=e.which;});},close:function(){$j(this).remove();}});}
function kfm_run_delayed(name,call){name=name+'_timeout';if(window[name])clearTimeout(window[name]);window[name]=setTimeout(call,500);}
function kfm_shrinkName(name,wrapper,text,size,maxsize,extension){var position=step=Math.ceil(name.length/2),postfix='[...]'+extension,prefix=size=='offsetHeight'?'. ':'';do{text.innerHTML=prefix+name.substring(0,position)+postfix;step=Math.ceil(step/2);position+=(wrapper[size]>maxsize)?-step:step;}while(step>1);var html='<span class="filename">'+name.substring(0,position+(prefix?0:-1))+'</span><span style="color:red;text-decoration:none">[...]</span>';if(extension)html+='<span class="filename">'+extension+'</span>';text.innerHTML=html;}
function kfm_pluginIframeShow(url){if(url){$j('#plugin_iframe_div').remove();var jDiv=$j('<div id="plugin_iframe_div"></div>').css({'display':'none','position':'absolute','left':0,'top':0,'width':'100%','height':'100%','backgroundImage':'url(i/bg-black-75.png)','z-index':202});$j(jDiv).appendTo('body');$j(jDiv).append($j('<div id="plugin_iframe_header"></div>').css({'width':'100%','height':'25px','color':'white','backgroundColor':'black'}));kfm_pluginIframeButton('close');$j(jDiv).slideDown('normal',function(){var x=$j('body').width(),y=$j('body').height()-25;$j(this).append('<iframe id="plugin_iframe_element" src="'+url+'" style="width:100%;height:100%;"></iframe>');});}else{$j('#plugin_iframe_div').slideDown('normal');}}
function kfm_pluginIframeButton(code,text){var btncode,btn;var hdr=document.getElementById('plugin_iframe_header');if(!hdr)return;if(code=='close'){btn=$j('<img src="themes/'+kfm_theme+'/icons/remove.png"/>').click(function(){kfm_pluginIframeHide();});btn.css({'float':'right'});}else{btn=$j('<span class="kfm_plugin_iframe_button"></span>').click(function(){eval(code);});}
if(text)$j(btn).text(text);$j(btn).appendTo(hdr);}
function kfm_pluginIframeHide(){$j('#plugin_iframe_div').slideUp('normal');}
function kfm_pluginIframeMessage(message){var msgdiv=document.getElementById('plugin_iframe_message');if(!msgdiv)return;msgdiv.innerHTML=message;msgdiv.style.display='block';setTimeOut('document.getElementById("plugin_iframe_message").style.display="none";',3000);}
function kfm_pluginIframeVar(varname){var ifr=document.getElementById('plugin_iframe_element');if(!ifr)return null;var ifrvar=eval('ifr.contentWindow.'+varname);return ifrvar;}
var kfm_regexps={all_up_to_last_dot:/.*\./,all_up_to_last_slash:/.*\//,ascii_stuff:/%([89A-F][A-Z0-9])/g,get_filename_extension:/.*\.([^.]*)$/,percent_numbers:/%[1-9]/,plus:/\+/g,remove_filename_extension:/\.[^.]*$/}
llStubs.push('kfm_showMessage');function kfm_addContextMenu(el,fn){$j.event.add(el,'mousedown',function(e){if(e.button==2)fn(e);});return el;}
function kfm_contextmenuinit(){$j.event.add(document,'click',function(e){if(e.ctrlKey)return;if(!contextmenu)return;var c=contextmenu,m={x:e.pageX,y:pageY};var l=c.offsetLeft,t=c.offsetTop;if(m.x<l||m.x>l+c.offsetWidth||m.y<t||m.y>t+c.offsetHeight)kfm_closeContextMenu();});kfm_addContextMenu(document,function(e){if(window.webkit||!e.ctrlKey)e.stopPropagation();});}
kfm.cm={submenus:[]}
llStubs.push('kfm_closeContextMenu');llStubs.push('kfm_createContextMenu');document.oncontextmenu=function(e){return false;}
kfm_dir_bits={contextMenu:function(e){if(e.button!=2)return;var el=e.target;while(el&&!el.node_id)el=el.parentNode;if(!el)return;var links=[],i,node_id=el.node_id;if(kfm_vars.permissions.dir.ed){context_categories['edit'].add({name:'directory_rename',title:'rename directory',category:'edit',doFunction:function(){kfm_renameDirectory(node_id);}});}
if(kfm_vars.permissions.dir.mk)context_categories['main'].add({name:'directory_new',title:"create sub-directory",category:'main',doFunction:function(){kfm_createDirectory(node_id);}});if(node_id!=1&&kfm_vars.permissions.dir.rm)context_categories['edit'].add({name:'directory_delete',title:"delete",category:'edit',doFunction:function(){kfm_deleteDirectory(node_id);}});if(kfm_directories[node_id].writable){for(i=0;i<HooksDirectoryWritable.length;i++){obj=HooksDirectoryWritable[i];obj.doParameter=[node_id];context_categories[obj.category].add(obj);}}else{for(i=0;i<HooksDirectoryReadonly.length;i++){obj=HooksDirectoryReadonly[i];obj.doParameter=[node_id];context_categories[obj.category].add(obj);}}},clickDir:function(e){if(e.type=="contextmenu"||e.button==2)return;kfm_changeDirectory(this.id);},removeHover:function(){kfm_directory_over=0;$j(this).removeClass('hovered');},addHover:function(){if(kfm_directory_over==this.node_id)return;this.className+=' hovered';kfm_directory_over=+this.node_id;},idealNameHeight:0,dirnames_being_drawn:0,dirnames_wrappers:[]};function kfm_changeDirectory(id,nofiles){if(!isNaN(id))id='kfm_directory_icon_'+id;if(id=='kfm_directory_icon_0')id='kfm_directory_icon_1';var el=document.getElementById(id);if(!el)return;var a,els=$j('td.kfm_directory_open');setTimeout('clearTimeout(window.dragTrigger);',1);if(window.ie)while(el&&!el.node_id)el=el.parentNode;kfm_cwd_name=el.kfm_directoryname;kfm_cwd_id=el.node_id;clearTimeout(window.kfm_incrementalFileDisplay_loader);for(var a=0;a<els.length;++a)$j(els[a]).removeClass('kfm_directory_open');el.parentNode.className+=' kfm_directory_open';if(!nofiles){kfm_filesLoader();setTimeout('x_kfm_loadFiles(kfm_cwd_id,kfm_refreshFiles);',20);}
setTimeout('x_kfm_loadDirectories(kfm_cwd_id,kfm_refreshDirectories);',20);}
function kfm_createDirectory(id){if(!kfm_vars.permissions.dir.mk)return kfm.alert(_('permission denied: cannot create directory'));kfm_prompt(kfm.lang.CreateDirMessage(kfm_directories[id].path),'',function(newName){if(newName&&newName!=''&&!/\/|^\./.test(newName))x_kfm_createDirectory(id,newName,kfm_refreshDirectories);});}
function kfm_deleteDirectory(id){if(!kfm_vars.permissions.dir.rm)return kfm.alert(_('permission denied: cannot delete directory'));kfm.confirm(kfm.lang.DelDirMessage(kfm_directories[id].path),function(){if(kfm_directories[id].hasChildren){kfm.confirm(kfm.lang.RecursiveDeleteWarning(kfm_directories[id].name),function(){x_kfm_deleteDirectory(id,kfm_deleteDirectoryCheck);});}else{x_kfm_deleteDirectory(id,kfm_deleteDirectoryCheck);}});}
function kfm_deleteDirectoryCheck(res){if(res.type&&res.type=='error'){switch(parseInt(res.msg)){case 1:case 3:case 4:break;case 2:{kfm.confirm(kfm.lang.RecursiveDeleteWarning(res.name),function(){x_kfm_deleteDirectory(res.id,1,kfm_deleteDirectoryCheck);});break;}
default:new Notice(res.msg);}}
else{var is_found=0,p=res.oldpid;while(p&&!is_found){if(p==kfm_cwd_id)is_found=1;p=kfm_directories[p].parent;}
if(is_found)kfm_changeDirectory('kfm_directory_icon_'+p);kfm_refreshDirectories(res);}}
function kfm_dir_addLink(t,parent_addr,is_last,data,timeout){var r,c,pdir,name,name_text,el,openerEl,name,parent,rhtml;name=data[0];parent=data[2];pdir=parent_addr+name;rhtml='<tr><td class="kfm_dir_lines_'+(is_last?'lastchild':'child')+'" width="16px">';if(data[1]){rhtml+='<a href="javascript:kfm_dir_openNode('+parent+')" id="kfm_dir_node_'+parent+'" class="kfm_dir_node_closed">[+]</a>';}
else{rhtml+='<span id="kfm_dir_node_'+parent+'">&nbsp;</span>';}
rhtml+='</td><td class="kfm_dir_name"><div id="kfm_directory_icon_'+parent+'" class="kfm_directory_link '+(kfm_cwd_name==pdir?'':'kfm_directory_open')+'">';rhtml+=(name==''?kfm_vars.root_folder_name:name);rhtml+='</div></td></tr>';$j(rhtml).appendTo(t);$j('<tr><td'+(is_last?'':' class="kfm_dir_lines_nochild"')+'></td><td id="kfm_directories_subdirs_'+parent+'"></td></tr>').appendTo(t);kfm.directory_attributes.push([parent,pdir,data[3],data[4]]);return t;}
function kfm_dir_add_attributes(){var i=0,j=kfm.directory_attributes.length,el,data;for(;i<j;++i){data=kfm.directory_attributes[i];var pid=data[0],pdir=data[1],x=data[2],y=data[3];el=document.getElementById('kfm_directory_icon_'+pid);el.kfm_directoryname=pdir;el.node_id=pid;if(x||y){el.title+="\nimage size constraint: "+data[3]+"x"+data[4];el.className+=" constrainedSize";}}
kdnd_makeDraggable('kfm_dir_name');kdnd_addDropHandler('kfm_dir_name','.kfm_dir_name',kfm_dir_dropHandler);kfm.directory_attributes=[];}
function kfm_dir_dropHandler(e){var dir_from=parseInt($j('.kfm_directory_link',e.sourceElement).attr('node_id'));if(dir_from==1)return;var dir_to=parseInt($j('.kfm_directory_link',e.targetElement).attr('node_id'));if(dir_to==0||dir_to==dir_from)return;if(!kfm_vars.permissions.dir.mv)return kfm.alert(_("permission denied cannot move directory",0,0,1));x_kfm_moveDirectory(dir_from,dir_to,kfm_refreshDirectories);kfm_selectNone();}
function kfm_dir_openNode(dir){var node=document.getElementById('kfm_dir_node_'+dir);node.className='kfm_dir_node_opened';if(node.href)node.href=node.href.replace(/open/,'close');document.getElementById('kfm_directories_subdirs_'+dir).innerHTML=_("loading",0,0,1);x_kfm_loadDirectories(dir,kfm_refreshDirectories);}
function kfm_dir_closeNode(dir){var node=document.getElementById('kfm_dir_node_'+dir);node.className='kfm_dir_node_closed';if(node.href)node.href=node.href.replace(/close/,'open');document.getElementById('kfm_directories_subdirs_'+dir).innerHTML='';}
function kfm_refreshDirectories(res){kfm.directory_attributes=[];var d,p,t;if(res.toString()===res)return;d=res.parent;if(d==kfm_vars.root_folder_id){p=document.getElementById('kfm_directories');t=document.createElement('table');t.id='kfm_directories';p.parentNode.replaceChild(kfm_dir_addLink(t,'',1,['',0,kfm_vars.root_folder_id]),p);kfm_directories[kfm_vars.root_folder_id]={'parent':0,'name':kfm_vars.root_folder_name,'path':'/','realpath':res.properties.path,'hasChildren':res.directories.length,'writable':res.properties.writable}
document.getElementById('kfm_directory_icon_'+kfm_vars.root_folder_id).parentNode.className+=' kfm_directory_open';}
t=document.createElement('table'),n='kfm_dir_node_'+d;t.style.tableLayout='fixed';dirwrapper=document.getElementById('kfm_directories_subdirs_'+d);dirwrapper.innerHTML='';dirwrapper.appendChild(t);var dirs=res.directories,i=1;dirs.each(function(dir,a){kfm_dir_addLink(t,res.reqdir,l=(a==dirs.length-1),dir);kfm_directories[dir[2]]={'parent':res.parent,'name':dir[0],'path':res.reqdir+dir[0],'realpath':res.properties.path+dir[0]+'/','hasChildren':dir[1],'writable':res.properties.writable,'maxWidth':dir[3],'maxHeight':dir[4]};});setTimeout(kfm_dir_add_attributes,1);if(d!=''){p2=document.getElementById(n).parentNode;p2.innerHTML='';var openerEl;if(dirs.length){openerEl=$j('<a href="javascript:kfm_dir_closeNode('+res.parent+')" id="'+n+'" class="kfm_dir_node_open">[-]</a>')[0];}
else{openerEl=document.createElement('span');openerEl.id=n;openerEl.innerHTML=' ';}
p2.appendChild(openerEl);}
kfm_cwd_subdirs[d]=res.directories;if(!kfm_cwd_subdirs[d])kfm_dir_openNode(res.parent);kfm_setDirectoryProperties(res.properties);if(!kfm_vars.startup_sequence)kfm_selectNone();kfm_directories[kfm_cwd_id]=res.properties;kfm_directories[d].hasChildren=1;if(kfm_startup_sequence_index<kfm_vars.startup_sequence.length){setTimeout(function(){kfm_changeDirectory(kfm_vars.startup_sequence[kfm_startup_sequence_index],true);kfm_startup_sequence_index++;if(kfm_startup_sequence_index>kfm_vars.startup_sequence.length)kfm_vars.startup_sequence=false;},dirs.length+1);}
else kfm_refreshPanels('kfm_left_column');}
function kfm_renameDirectory(id){var directoryName=kfm_directories[id].name;kfm_prompt(kfm.lang.RenameTheDirectoryToWhat(directoryName),directoryName,function(newName){if(!newName||newName==directoryName)return;kfm_directories[id]=null;x_kfm_renameDirectory(id,newName,kfm_refreshDirectories);});}
function kfm_setDirectoryProperties(properties){var wrapper=document.getElementById('kfm_directory_properties');if(!wrapper)return;wrapper.innerHTML='';wrapper.properties=properties;var table=document.createElement('table'),row,cell,i;{i=properties.allowed_file_extensions.length?properties.allowed_file_extensions.join(', '):_("no restrictions",0,0,1);row=kfm.addRow(table);var nameEl=document.createElement('strong');nameEl.innerHTML=kfm.lang.Name;kfm.addCell(row,0,0,nameEl);kfm.addCell(row,1,0,'/'+kfm_cwd_name);}
{i=properties.allowed_file_extensions.length?properties.allowed_file_extensions.join(', '):_("no restrictions",0,0,1);row=kfm.addRow(table);var extensionsEl=document.createElement('strong');extensionsEl.innerHTML=_("allowed file extensions",0,0,1);kfm.addCell(row,0,0,extensionsEl);kfm.addCell(row,1,0,i);}
wrapper.appendChild(table);}
$j('.kfm_directory_link').live('mouseover',window.kfm_dir_bits.addHover);$j('.kfm_directory_link').live('click',window.kfm_dir_bits.clickDir);$j('.kfm_directory_link').live('mouseout',window.kfm_dir_bits.removeHover);$j('.kfm_directory_link').live('mousedown',window.kfm_dir_bits.contextMenu);function kfm_addToSelection(id){id=parseInt(id);if(!id||selectedFiles.indexOf(id)!=-1)return;selectedFiles.push(id);document.getElementById('kfm_file_icon_'+id).className+=' selected';kfm_selectionCheck();}
function kfm_isFileSelected(filename){return kfm_inArray(filename,selectedFiles);}
function kfm_removeFromSelection(id){if(!id)return;var i;for(i=0;i<selectedFiles.length;++i){if(selectedFiles[i]==id){$j('#kfm_file_icon_'+id).removeClass('selected');kfm_selectionCheck();return selectedFiles.splice(i,1);}}}
function kfm_selectAll(){kfm_selectNone();var a,b=document.getElementById('documents_body').fileids;for(a=0;a<b.length;++a)kfm_addToSelection(b[a]);}
function kfm_selectInvert(){var a,b=document.getElementById('documents_body').fileids;for(a=0;a<b.length;++a)if(kfm_isFileSelected(b[a]))kfm_removeFromSelection(b[a]);else kfm_addToSelection(b[a]);}
function kfm_selectNone(){if(kfm_lastClicked){$j('#kfm_file_icon_'+kfm_lastClicked).removeClass('last_clicked');}
for(var i=selectedFiles.length;i>-1;--i)kfm_removeFromSelection(selectedFiles[i]);kfm_lastClicked=0;kfm_selectionCheck();}
function kfm_selectionCheck(){if(selectedFiles.length==1){var el=$j('#kfm_file_details_panel div.kfm_panel_body')[0];if(el)el.innerHTML='loading';kfm_run_delayed('file_details','if(selectedFiles.length==1)kfm_showFileDetails(selectedFiles[0]);');}
else kfm_run_delayed('file_details','if(!selectedFiles.length)kfm_showFileDetails();');}
function kfm_selection_drag(e){if(!window.dragType||window.dragType!=2||!window.drag_wrapper)return;clearSelections();var p1={x:e.pageX,y:e.pageY},p2=window.drag_wrapper.orig;var x1=p1.x>p2.x?p2.x:p1.x;var x2=p2.x>p1.x?p2.x:p1.x;var y1=p1.y>p2.y?p2.y:p1.y;var y2=p2.y>p1.y?p2.y:p1.y;window.drag_wrapper.style.display='block';window.drag_wrapper.style.left=x1+'px';window.drag_wrapper.style.top=y1+'px'
window.drag_wrapper.style.width=(x2-x1)+'px';window.drag_wrapper.style.height=(y2-y1)+'px';window.drag_wrapper.style.zIndex=4;}
llStubs.push('kfm_selection_dragFinish');function kfm_selection_dragStart(e){if(window.dragType)return;if(!kfm_vars.use_templates&&window.mouseAt.x>document.getElementById('kfm_right_column').scrollWidth+document.getElementById('kfm_left_column').scrollWidth-15)return;window.dragType=2;$j.event.add(document,'mouseup',kfm_selection_dragFinish);window.drag_wrapper=document.createElement('div');window.drag_wrapper.id='kfm_selection_drag_wrapper';window.drag_wrapper.style.display='none';window.drag_wrapper.orig=window.mouseAt;kfm.addEl(document.body,window.drag_wrapper);$j.event.add(document,'mousemove',kfm_selection_drag);}
function kfm_shiftFileSelectionLR(dir){if(selectedFiles.length>1)return;var na=document.getElementById('documents_body').fileids,a=0,ns=na.length;if(selectedFiles.length){for(;a<ns;++a)if(na[a]==selectedFiles[0])break;if(dir>0){if(a==ns-1)a=-1}
else if(!a)a=ns;}
else a=dir>0?-1:ns;kfm_selectSingleFile(na[a+dir]);}
function kfm_shiftFileSelectionUD(dir){if(selectedFiles.length>1)return;var na=document.getElementById('documents_body').fileids,a=0,ns=na.length,icons_per_line=0,topOffset=document.getElementById('kfm_file_icon_'+na[0]).offsetTop;if(selectedFiles.length){if(topOffset==document.getElementById('kfm_file_icon_'+na[ns-1]).offsetTop)return;for(;document.getElementById('kfm_file_icon_'+na[icons_per_line]).offsetTop==topOffset;++icons_per_line);for(;a<ns;++a)if(na[a]==selectedFiles[0])break;a+=icons_per_line*dir;if(a>=ns)a=ns-1;if(a<0)a=0;}
else a=dir>0?0:ns-1;kfm_selectSingleFile(na[a]);}
function kfm_toggleSelectedFile(e){var row;if(e.type=="contextmenu"||e.button==2)return;e.stopPropagation();kfm_closeContextMenu();if(window.dragAddedFileToSelection){window.dragAddedFileToSelection=false;return;}
var el=e.target;while(el.tagName!='DIV')el=el.parentNode;var id=el.file_id;if(kfm_listview){row=el;while(row.nodeName!='TR')row=row.parentNode;rowInd=row.rowIndex;}
if(kfm_lastClicked){var el=document.getElementById('kfm_file_icon_'+kfm_lastClicked);if(el)$j(el).removeClass('last_clicked');else kfm_lastClicked=0;}
if(kfm_lastClicked&&e.shift){var e=kfm_lastClicked;if(kfm_listview){row=el;while(row.nodeName!='TR')row=row.parentNode;smalRow=Math.min(row.rowIndex,rowInd);bigRow=Math.max(row.rowIndex,rowInd);$j('#kfm_files_listview_table tbody tr:lt('+bigRow+')').each(function(){if(this.rowIndex>=smalRow)kfm_addToSelection(this.fileid);});}else{clearSelections(e);kfm_selectNone();var a=document.getElementById('documents_body').fileids,b,c,d;for(b=0;b<a.length;++b){if(a[b]==e)c=b;if(a[b]==id)d=parseInt(b);}
if(c>d){b=c;c=d;d=b;}
for(;c<=d;++c)kfm_addToSelection(a[c]);}}
else{if(kfm_isFileSelected(id)){if(!e.control)kfm_selectNone();else kfm_removeFromSelection(id);}
else{if(!e.control&&!e.meta)kfm_selectNone();kfm_addToSelection(id);}}
kfm_lastClicked=id;document.getElementById('kfm_file_icon_'+id).className+=' last_clicked';}
function kfm_selectSingleFile(id){kfm_selectNone();kfm_addToSelection(id);var panel=document.getElementById('kfm_right_column'),el=document.getElementById('kfm_file_icon_'+id);var offset=panel.scrollTop,panelHeight=panel.offsetHeight,elTop=getOffset(el,'Top'),elHeight=el.offsetHeight;if(elTop+elHeight-offset>panelHeight)panel.scrollTop=elTop-panelHeight+elHeight;else if(elTop<offset)panel.scrollTop=elTop;}
llStubs.push('kfm_createEmptyFile');llStubs.push('kfm_leftColumn_disable');llStubs.push('kfm_leftColumn_enable');var HookCategories=["main","view","edit","returning",'selection','kfm'];var show_category_headers=true;var context_categories={};for(i=0;i<HookCategories.length;i++){var catname=HookCategories[i];var cat=new kfm_context_category(catname);context_categories[catname]=cat;}
var kfm_imageExtensions=['jpg','png','gif','jpeg'];var HooksSingleReadonly={};var HooksSingleWritable={};var HooksMultiple={};var HooksFilePanel=[];var HooksDirectoryReadonly=[];var HooksDirectoryWritable=[];var HooksGlobal=[];function kfm_addHook(objoriginal,properties){var obj=objoriginal;if(properties){if(typeof(properties.doFunction)!="undefined"){if(typeof(properties.doFunction)=="function")obj.doFunction=properties.doFunction;if(typeof(properties.doFunction)=="string")obj.doFunction=obj[properties.doFunction];}
if(typeof(properties.mode)!="undefined")obj.mode=properties.mode;if(typeof(properties.title)!="undefined")obj.title=properties.title;if(typeof(properties.name)!="undefined")obj.name=properties.name;if(typeof(properties.category)!="undefined")obj.category=properties.category;if(typeof(properties.defaultOpener)!="undefined")obj.defaultOpener=properties.defaultOpener;if(typeof(properties.writable)!="undefined")obj.writable=properties.writable;if(typeof(properties.extensions)!="undefined")obj.extensions=properties.extensions;}
if(typeof(obj.name)=="undefined"&&typeof(obj.title)!="undefined")obj.name=obj.title;if(typeof(obj.category)=="undefined")obj.category=HookCategories[0];if(!obj.extensions)obj.extensions="all";if(!kfm_vars.permissions.file.ed&&obj.category=='edit')return;if(!kfm_vars.permissions.image.manip&&obj.category=='edit'){if(obj.extensions=='all')return;for(var i=0;i<obj.extensions.length;i++){for(var j=0;j<kfm_imageExtensions.length;j++){if(obj.extensions[i]==kfm_imageExtensions[j]){obj.extensions.splice(i,1);return;}}}}
if(obj.mode==0||obj.mode==2){if(obj.writable==1||obj.writable==2)kfm_addHookToArray(obj,"HooksSingleWritable");if(obj.writable==0||obj.writable==2)kfm_addHookToArray(obj,"HooksSingleReadonly");}
if(obj.mode==1||obj.mode==2){kfm_addHookToArray(obj,"HooksMultiple");}
if(obj.mode==3){HooksFilePanel.push(obj);}
if(obj.mode==4){if(obj.writable==0||obj.writable==2)HooksDirectoryReadonly.push(obj);if(obj.writable==1||obj.writable==2)HooksDirectoryWritable.push(obj);}
if(obj.mode==5)HooksGlobal.push(obj);}
function kfm_addHookToArray(obj,HooksArray){if(!obj.extensions)return false;if(typeof(obj.extensions)=="string"&&obj.extensions.toLowerCase()=="all"||HooksArray=="HooksMultiple"){ext="all";if(typeof(window[HooksArray][ext])=="undefined")kfm_addHookExtension(HooksArray,ext);if(typeof(window[HooksArray][ext][obj.category])=="undefined")kfm_addHookCategory(HooksArray,ext,obj.category);window[HooksArray][ext][obj.category].push(obj);}else{for(var i=0;i<obj.extensions.length;i++){ext=obj.extensions[i];if(typeof(window[HooksArray][ext])=="undefined")kfm_addHookExtension(HooksArray,ext);if(typeof(window[HooksArray][ext][obj.category])=="undefined")kfm_addHookCategory(HooksArray,ext,obj.category);window[HooksArray][ext][obj.category].push(obj);}}}
function kfm_addHookExtension(HooksArray,ext){window[HooksArray][ext]={};}
function kfm_addHookCategory(HookArray,ext,newCategory){window[HookArray][ext][newCategory]=[];}
function kfm_getLinks(files,nocontext){var HooksArray="";var cPlugins=[];function addPlugin(plugin,fid,category){var add=true;var index=-1;for(var i=0;i<cPlugins.length;i++){if(cPlugins[i].name==plugin.name){add=false;index=i;break;}}
if(add){cPlugins.push(plugin);index=cPlugins.length-1;cPlugins[index].doParameter=[];}
cPlugins[index].doParameter.push(fid);if(add&&!nocontext)context_categories[category].add(cPlugins[index]);}
if(files.length>1){for(var i=0;i<files.length;i++){var F=File_getInstance(files[i]);var extension=F.ext;for(var k=0;k<HookCategories.length;k++){if(HooksMultiple.all[HookCategories[k]])plugins=HooksMultiple.all[HookCategories[k]];else plugins=[];for(var j=0;j<plugins.length;j++){var plugin=plugins[j];if(F.writable&&(plugin.writable==1||plugin.writable==2)&&((typeof(plugin.extensions)=="string"&&plugin.extensions=="all")||plugin.extensions.indexOf(extension)!=-1))
addPlugin(plugin,F.id,HookCategories[k]);else if(!F.writable&&(plugin.writable==0||plugin.writable==2)&&((typeof(plugin.extensions)=="string"&&plugin.extensions=="all")||plugin.extensions.indexOf(extension)!=-1))
addPlugin(plugin,F.id,HookCategories[k]);}}}
return cPlugins;}
var hookObjects=[];var F=File_getInstance(files[0]);var ext=F.ext;if(F.writable)HooksArray="HooksSingleWritable";else HooksArray="HooksSingleReadonly";for(var j=0;j<HookCategories.length;j++){category=HookCategories[j];if(typeof(window[HooksArray]['all'][category])!='undefined')hookObjects.extend(window[HooksArray]['all'][category]);if(window[HooksArray][ext]&&typeof(window[HooksArray][ext][category])!='undefined')hookObjects.extend(window[HooksArray][ext][category]);}
if(!nocontext){for(j=0;j<hookObjects.length;++j){var item=hookObjects[j];if(kfm_vars.associations[F.ext]&&kfm_vars.associations[F.ext]==item.name){context_categories['main'].add({name:'open',title:'open',category:'main',doFunction:item.doFunction,doParameter:item.doParameter},true);}
item.doParameter=[F.id];context_categories[item.category].add(item);};}
return hookObjects;}
function kfm_getDefaultOpener(files){var plugin_name;var F=File_getInstance(files[0]);if(kfm_vars.associations[F.ext]){var hooks=kfm_getLinks(files,true);plugin_name=kfm_vars.associations[F.ext];for(var i=0;i<hooks.length;++i){if(hooks[i].name==plugin_name)return hooks[i];}}
else if(kfm_vars.associations['all']){var hooks=kfm_getLinks(files,true);plugin_name=kfm_vars.associations['all'];for(var i=0;i<hooks.length;++i){if(hooks[i].name==plugin_name)return hooks[i];}}
return false;}
function kfm_context_category(name){this.name=name;this.title=this.name;this.type='context_category';this.items=[];this.add=function(item,first){if(typeof(item)=='array'){for(var i=0;i<item.length;i++)this.add(item[i]);}else{if(first)this.items.unshift(item);else this.items.push(item);}}
this.size=function(){return this.items.length;}
this.clear=function(){this.items=[];}}
llStubs.push('kfm_modal_close');llStubs.push('kfm_modal_open');function kfm_addPanel(wrapper,panel){var t;if(!wrapper)return false;if(kfm_hasPanel(wrapper,panel)){document.getElementById(panel).visible=1;kfm_refreshPanels(wrapper);return;}
if(panel=='kfm_directories_panel'){t=document.createElement('table');t.id='kfm_directories';el=kfm_createPanel(kfm.lang.Directories,'kfm_directories_panel',t,{'state':1,'abilities':-1,'order':1});}
else if(panel=='kfm_directory_properties_panel'){t=document.createElement('div');t.className='kfm_directory_properties';el=kfm_createPanel(kfm.lang.DirectoryProperties,'kfm_directory_properties_panel',t,{state:0,abilities:1});}
else if(panel=='kfm_file_details_panel')el=kfm_createFileDetailsPanel();else if(panel=='kfm_file_upload_panel')el=kfm_createFileUploadPanel();else if(panel=='kfm_search_panel')el=kfm_createSearchPanel();else if(panel=='kfm_widgets_panel')el=kfm_createWidgetsPanel();else return;if(!wrapper.panels)wrapper.panels=[];wrapper.panels[wrapper.panels.length]=panel;wrapper.appendChild(el);}
function kfm_createFileUploadPanel(contentsonly){var sel=newSelectbox('uploadType',[kfm.lang.Upload,kfm.lang.CopyFromURL],0,0,function(){var copy=parseInt(this.selectedIndex);var unzip1=document.getElementById('kfm_unzip1'),unzip2=document.getElementById('kfm_unzip2'),file=document.getElementById('kfm_file'),url=document.getElementById('kfm_url');if(unzip1)unzip1.style.visibility='hidden';if(unzip2)unzip2.style.visibility='hidden';if(file)file.value='';if(url)url.value='';document.getElementById('kfm_uploadWrapper').style.display=copy?'none':'block';document.getElementById('kfm_copyForm').style.display=copy?'block':'none';});var wrapper=document.createElement('div'),f1;wrapper.id='kfm_uploadWrapper';var iframe=document.createElement('iframe');iframe.id='kfm_iframe';iframe.name='kfm_iframe';iframe.src='javascript:false';iframe.style.display='none';var inp=document.createElement('input'),nm=false;inp.type='file';if('multiple'in inp){inp.setAttribute('multiple','multiple');nm=true;}
wrapper.appendChild((nm||!kfm_vars.use_multiple_file_upload)?kfm_fileUploadForm_native():kfm_fileUploadForm_flash());var f2=document.createElement('div');f2.id='kfm_copyForm';f2.style.display='none';var submit2=newInput('upload','submit',kfm.lang.CopyFromURL);var inp2=newInput('kfm_url',0,0,0,0,'width:100%');inp2.onkeyup=kfm_uploadPanel_checkForZip;inp2.onchange=kfm_uploadPanel_checkForZip;submit2.onclick=kfm_downloadFileFromUrl;var unzip2=document.createElement('span');unzip2.id='kfm_unzip2';unzip2.className='kfm_unzipWhenUploaded';unzip2.style.visibility='hidden';kfm.addEl(unzip2,[newInput('kfm_unzipWhenUploaded','checkbox'),kfm.lang.ExtractAfterUpload]);kfm.addEl(f2,[inp2,submit2,unzip2]);var contents=[sel,wrapper,iframe,f2];return contentsonly?contents:kfm_createPanel(kfm.lang.FileUpload,'kfm_file_upload_panel',contents,{maxedState:3,state:3,order:2});}
function kfm_fileUploadForm_native(){var f1;if(window.ie)f1=document.createElement('<form action="upload.php" method="POST" enctype="multipart/form-data" target="kfm_iframe">');else{f1=document.createElement('form');f1.action='upload.php';f1.method='POST';f1.enctype='multipart/form-data';f1.target='kfm_iframe';}
f1.id='kfm_uploadForm';var max_upload_size=document.createElement('input');max_upload_size.id='MAX_FILE_SIZE';max_upload_size.name='MAX_FILE_SIZE';max_upload_size.type='hidden';max_upload_size.value='9999999999';var submit=newInput('upload','submit',kfm.lang.Upload);$j.event.add(submit,'click',function(e){if(e.button!=0)return;setTimeout('$j("#kfm_file").replaceWith(kfm_fileUploadForm_getNativeInput());',1);});var unzip1=document.createElement('span');unzip1.id='kfm_unzip1';unzip1.className='kfm_unzipWhenUploaded';unzip1.style.visibility='hidden';kfm.addEl(unzip1,[newInput('kfm_unzipWhenUploaded','checkbox'),kfm.lang.ExtractAfterUpload]);kfm.addEl(f1,[kfm_fileUploadForm_getNativeInput(),max_upload_size,submit,unzip1]);return f1;}
function kfm_fileUploadForm_getNativeInput(){var input=newInput('kfm_file','file');input.setAttribute('multiple','multiple');if(input.multiple)input.name='kfm_file[]';$j.event.add(input,'keyup',kfm_uploadPanel_checkForZip);$j.event.add(input,'change',kfm_uploadPanel_checkForZip);return input;}
function kfm_fileUploadForm_flash(){var t=document.createElement('table');t.id='kfm_uploadFormSwf';var r=t.insertRow(0);var c=r.insertCell(0);var b1=document.createElement('span');b1.id='swfupload_browse_button';c.appendChild(b1);c=r.insertCell(1);var b2=document.createElement('input');b2.id='kfm_fileUploadSWFCancel';b2.type='button';b2.value=kfm.lang.Cancel;b2.disabled='disabled';c.appendChild(b2);r=t.insertRow(1);c=r.insertCell(0);c.colSpan=2;c.id='kfm_uploadProgress';c.innerHTML='&nbsp;';setTimeout(function(){var post_params={"swf":1,"kfm_session":window.session_key};post_params[window.phpsession_name]=window.phpsession_id;window.swfUpload=new SWFUpload({upload_url:"upload.php",post_params:post_params,file_size_limit:"9999 MB",file_types:"*.*",file_types_description:"All Files",file_upload_limit:"0",file_queue_error_handler:function(a){kfm_showMessage("error: "+a.name+" could not be uploaded");},file_dialog_complete_handler:function(a){var stats=this.getStats();if(!stats.files_queued)return;document.getElementById('kfm_fileUploadSWFCancel').disabled=null;this.kfm_file_at=1;this.settings.upload_progress_handler({'size':1},0);this.settings.post_params.cwd=kfm_cwd_id;this.startUpload();},swfupload_loaded_handler:function(){},upload_progress_handler:function(file,bytes_uploaded){var percent=Math.ceil((bytes_uploaded/file.size)*100);document.getElementById('kfm_uploadProgress').innerHTML='file '+window.swfUpload.kfm_file_at+' :'+percent+'%';},upload_error_handler:function(a){for(i in a)alert(i+"\n"+a[i]);},upload_success_handler:function(a,sdata){++window.swfUpload.kfm_file_at;if(sdata!='OK')new Notice("error uploading file:\n\n"+sdata);setTimeout("window.swfUpload.startUpload()",1);},upload_complete_handler:function(a){x_kfm_loadFiles(kfm_cwd_id,kfm_refreshFiles);document.getElementById('kfm_uploadProgress').innerHTML='&nbsp;';document.getElementById('kfm_fileUploadSWFCancel').disabled='disabled';},button_placeholder_id:"swfupload_browse_button",button_width:61,button_height:22,button_text:'<span class="button">Browse...</span>',button_text_style:'.button { font-family: Helvetica, Arial, sans-serif; font-size: 12pt; } .buttonSmall { font-size: 12pt; }',button_image_url:'./themes/default/bitsandpieces/XPButtonNoText_61x22.png',button_text_left_padding:2,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,flash_url:"third-party/swfupload/Flash/swfupload.swf",custom_settings:{upload_target:"kfm_iframe"},debug:false});},1);$j.event.add(b2,'click',function(e){if(e.button==2)return;window.swfUpload.cancelUpload();});return t;}
function kfm_createFileDetailsPanel(){return kfm_createPanel(kfm.lang["file details"],'kfm_file_details_panel',0,{abilities:1,order:4});}
function kfm_createPanel(title,id,subels,vars){var panelEl=document.createElement('div');panelEl.id=id;panelEl.className='kfm_panel';var titleEl=document.createElement('div');titleEl.className='kfm_panel_header';titleEl.innerHTML=title;var bodyEl=document.createElement('div');bodyEl.className='kfm_panel_body';kfm.addEl(bodyEl,subels);kfm.addEl(panelEl,[titleEl,bodyEl]);var el=$extend(panelEl,{state:0,height:0,panel_title:title,abilities:0,visible:1,order:99,addCloseButton:function(){if(this.abilities&1)this.addButton('removePanel','','x',kfm.lang.Close)},addMaxButton:function(){this.addButton('maximisePanel','','M',kfm.lang.Maximise)},addMinButton:function(){this.addButton('minimisePanel','','_',kfm.lang.Minimise)},addMoveDownButton:function(){if(this.id!=this.parentNode.panels[this.parentNode.panels.length-1])this.addButton('movePanel',',1','d',kfm.lang.MoveDown)},addMoveUpButton:function(){if(this.id!=this.parentNode.panels[0])this.addButton('movePanel',',-1','u',kfm.lang.MoveUp)},addRestoreButton:function(){this.addButton('restorePanel','','r',kfm.lang.Restore)},addButton:function(f,p,b,t){if(this.abilities==-1||!this.childNodes[0])return;this.childNodes[0].appendChild(newLink('javascript:kfm_'+f+'(document.getElementById("'+this.parentNode.id+'"),document.getElementById("'+this.id+'")'+p+')','['+b+']',0,'kfm_panel_header_'+b,t));}});if(vars)el=$extend(el,vars);return el;}
function kfm_createPanelWrapper(name){var p=document.createElement('div');p.id=name;p.className='kfm_panel_wrapper';p.panels=[];return p;}
function kfm_createSearchPanel(contentsonly){var t,r,inp,rows=0;t=document.createElement('table');t.id='kfm_search_table';{r=t.insertRow(rows++);r.insertCell(0).appendChild(newText(kfm.lang.Filename));r.insertCell(1).appendChild(kfm_searchBoxFile());}
{r=t.insertRow(rows++);r.insertCell(0).appendChild(newText(kfm.lang.Tags));inp=newInput('kfm_search_tags');inp.title=kfm.lang.CommaSeparated;inp.onkeyup=kfm_runSearch;r.insertCell(1).appendChild(inp);}
return kfm_createPanel(kfm.lang.Search,'kfm_search_panel',t,{maxedState:3,state:3,order:3});}
function kfm_createWidgetsPanel(){var widgets=[];kfm_widgets.each(function(el){widgets.push(el.display());});el=kfm_createPanel('Widgets','kfm_widgets_panel',widgets,{'state':3});return el;}
function kfm_hasPanel(wrapper,panel){for(var i=0;i<wrapper.panels.length;++i)if(wrapper.panels[i]==panel)return true;return false;}
function kfm_minimisePanel(wrapper,panel){panel.state=0;kfm_refreshPanels(wrapper);}
function kfm_maximisePanel(wrapper,panel){panel.state=panel.maxedState==3?3:1;kfm_refreshPanels(wrapper);}
function kfm_movePanel(wrapper,panel,offset){var i=0,j,k;for(;i<wrapper.panels.length;++i)if(wrapper.panels[i]==panel.id)j=i;if(offset<0)--j;k=wrapper.panels[j];wrapper.panels[j]=wrapper.panels[j+1];wrapper.panels[j+1]=k;wrapper.insertBefore(document.getElementById(wrapper.panels[j]),document.getElementById(wrapper.panels[j+1]));kfm_refreshPanels(wrapper);}
function kfm_refreshPanels(wrapper){if($type(wrapper)=='string')wrapper=document.getElementById(wrapper);if(!wrapper)return false;var ps=wrapper.panels,i,minheight=0;var minimised=[],maximised=[],fixed_height=[],fixed_height_maxed=[];for(i=0;i<ps.length;++i){var el=document.getElementById(ps[i]);if(kfm_inArray(el.id,kfm_hidden_panels))el.visible=false;if(el.id=='kfm_file_upload_panel')el.visible=kfm_directories[kfm_cwd_id].writable;if(el.visible){el.style.display='block';el.minheight=el.childNodes[0].offsetHeight;minheight+=el.minheight;switch(el.state){case 0:minimised[minimised.length]=ps[i];break;case 1:maximised[maximised.length]=ps[i];break;case 2:fixed_height[fixed_height.length]=ps[i];break;case 3:fixed_height_maxed[fixed_height_maxed.length]=ps[i];break;}}
else el.style.display='none';}
var height=wrapper.offsetHeight;for(i=0;i<minimised.length;++i){var n=minimised[i];var el=document.getElementById(n);el.childNodes[1].style.display='none';var head=el.childNodes[0],els=[];head.innerHTML='';if(wrapper.panels_unlocked){el.addCloseButton();el.addMaxButton();el.addMoveDownButton();el.addMoveUpButton();}
els[els.length]=el.panel_title;kfm.addEl(head,els);}
for(i=0;i<fixed_height.length;++i){var n=fixed_height[i];var el=document.getElementById(n);el.childNodes[1].style.height=el.height+'px';el.childNodes[1].style.display='block';minheight+=el.height;var head=el.childNodes[0],els=[];head.innerHTML='';if(wrapper.panels_unlocked){el.addCloseButton();el.addMaxButton();el.addMinButton();el.addMoveDownButton();el.addMoveUpButton();}
els[els.length]=el.panel_title;kfm.addEl(head,els);}
minheight=kfm_panels_drawFixedHeightMaxed(fixed_height_maxed,wrapper,minheight);kfm_panels_drawMaximised(maximised,height,minheight,wrapper);kfm_panels_fixOrder(wrapper);}
function kfm_panels_drawFixedHeightMaxed(fixed_height_maxed,wrapper,minheight){if(!fixed_height_maxed.length)return minheight;var n,el,body,head,i;for(i=0;i<fixed_height_maxed.length;++i){n=fixed_height_maxed[i];el=document.getElementById(n);body=el.childNodes[1];body.style.height='auto';body.style.display='block';minheight+=body.offsetHeight;head=el.childNodes[0];head.innerHTML='';if(wrapper.panels_unlocked){el.addCloseButton();el.addMinButton();el.addMoveDownButton();el.addMoveUpButton();}
kfm.addEl(head,el.panel_title);}
return minheight;}
function kfm_panels_drawMaximised(maximised,height,minheight,wrapper){if(!maximised.length)return;var size,n,el,head,i;size=(height-minheight)/maximised.length;for(i=0;i<maximised.length;++i){n=maximised[i];el=document.getElementById(n);el.childNodes[1].style.height=size+'px';el.childNodes[1].style.display='block';head=el.childNodes[0];head.innerHTML='';if(wrapper.panels_unlocked){el.addCloseButton();el.addRestoreButton();el.addMinButton();el.addMoveDownButton();el.addMoveUpButton();}
kfm.addEl(head,el.panel_title);}}
function kfm_panels_fixOrder(wrapper){var i,els,found,prev,order;do{els=wrapper.childNodes;found=0;prev=0;for(i=0;i<els.length,!found,els[i];++i){order=els[i].order;if(order<prev&&i){wrapper.insertBefore(els[i],els[i-1]);found=1;}
prev=order;}}while(found);}
function kfm_removePanel(wrapper,panel){if(!panel)return;panel.visible=0;kfm_refreshPanels(wrapper);}
function kfm_restorePanel(wrapper,panel){panel.state=2;if(!panel.height)panel.height=panel.childNodes[1].offsetHeight;kfm_refreshPanels(wrapper);}
function kfm_togglePanelsUnlocked(){var el=document.getElementById('kfm_left_column');el.panels_unlocked=1-el.panels_unlocked;kfm_refreshPanels('kfm_left_column');}
function kfm_uploadPanel_checkForZip(e){e.stopPropagation();var v=this.value;var h=(v.indexOf('.')==-1||v.replace(/.*(\.[^.]*)/,'$1')!='.zip');document.getElementById('kfm_unzip1').style.visibility=h?'hidden':'visible';document.getElementById('kfm_unzip2').style.visibility=h?'hidden':'visible';}
var kfm_kaejax_replaces={'([89A-F][A-Z0-9])':'%u00$1','22':'"','2C':',','3A':':','5B':'[','5D':']','7B':'{','7D':'}'};if(window.ie){window.kfm_kaejax_replaces_regexps=[];window.kfm_kaejax_replaces_replacements=[];for(var i in kfm_kaejax_replaces){kfm_kaejax_replaces_regexps.push(eval('/%'+i+'/g'));kfm_kaejax_replaces_replacements.push(kfm_kaejax_replaces[i]);}}
else{for(var a in kfm_kaejax_replaces){kfm_kaejax_replaces[kfm_kaejax_replaces[a]]=eval('/%'+a+'/g');delete kfm_kaejax_replaces[a];}}
var kfm_sanitise_ajax=window.ie?function(d){for(var a in window.kfm_kaejax_replaces_regexps)d=d.replace(kfm_kaejax_replaces_regexps[a],kfm_kaejax_replaces_replacements[a]);return d;}:function(d){var r=kfm_kaejax_replaces;for(var a in r)d=d.replace(r[a],a);return d;};function kdnd_addDropHandler(source_class,target_selector,func){if(!kdnd_targets[source_class])kdnd_targets[source_class]={};kdnd_targets[source_class][target_selector]=func;}
function kdnd_drag(e){if(!window.kdnd_dragging)return;var m={x:e.pageX,y:e.pageY};clearSelections();window.kdnd_drag_wrapper.style.position='absolute';window.kdnd_drag_wrapper.style.display='block';window.kdnd_drag_wrapper.style.left=(m.x+window.kdnd_offset.x)+'px';window.kdnd_drag_wrapper.style.top=(m.y+window.kdnd_offset.y)+'px';if($j(kdnd_source_el).hasClass('drag_this')){kdnd_source_el.style.visibility='hidden';}}
function kdnd_dragInit(el,source_class){return function(e){if(e.type=="contextmenu"||e.button==2)return;$j.event.add(document,'mouseup',function(e){kdnd_dragFinish(e);});clearTimeout(window.dragTrigger);window.dragTrigger=setTimeout(function(){kdnd_dragStart(el,source_class);},100);window.kdnd_offset={'x':el.offsetLeft-e.pageX,'y':el.offsetTop-e.pageY};e.stopPropagation();};}
function kdnd_dragStart(el,source_class){window.kdnd_dragging=true;window.kdnd_drag_class=source_class;window.kdnd_source_el=el;var content=el.dragDisplay?el.dragDisplay():el.cloneNode(true);if($j(el).css('position')=='absolute'||$j(el).css('position')=='fixed'){content.style.position='static';content.style.left=0;content.style.top=0;}
if(!$j(el).hasClass('drag_this'))window.kdnd_offset={'x':16,'y':0};window.kdnd_drag_wrapper=document.createElement('div');window.kdnd_drag_wrapper.id='kdnd_drag_wrapper';window.kdnd_drag_wrapper.style.display='none';window.kdnd_drag_wrapper.style.opacity=.7;window.kdnd_drag_wrapper.appendChild(content);document.body.appendChild(window.kdnd_drag_wrapper);$j.event.add(document,'mousemove',kdnd_drag);}
function kdnd_makeDraggable(source_class){if($type(source_class)=='array'){return source_class.each(kdnd_makeDraggable);}
$j('.'+source_class).each(function(key,el){if(el.kdnd_applied)return;el.kdnd_applied=true;if(!el.dragevents)el.dragevents=[];if(!el.dragevents[source_class])el.dragevents[source_class]=kdnd_dragInit(el,source_class);$j.event.add(el,'mousedown',el.dragevents[source_class]);});}
{var kdnd_targets=[];}
llStubs.push('kdnd_unmakeDraggable');llStubs.push('kdnd_dragFinish');function File(id,data){};File.prototype.getText=function(varname){var el=document.createElement('span');el.className=varname+' file_'+varname+'_'+this.id;this.setText(el,varname);if(!this.textInstances[varname])this.textInstances[varname]=[];this.textInstances[varname].push(el);return el;};File.prototype.initialize=function(id,data){this.id=id;this.textInstances=[];if(data){File_Instances[id]=this;File_setData(data,this);}
else x_kfm_getFileDetails(id,File_setData);};File.prototype.setText=function(el,varname){$j(el).empty();var v=$pick(this[varname],'');if(varname=='name'){if(!kfm_listview&&kfm_vars.files.name_length_displayed&&kfm_vars.files.name_length_displayed<v.length){el.title=v;v=v.substring(0,kfm_vars.files.name_length_displayed-3)+'...';}
else if(kfm_listview&&kfm_vars.files.name_length_in_list&&kfm_vars.files.name_length_in_list<v.length){el.title=v;v=v.substring(0,kfm_vars.files.name_length_in_list-3)+'...';}}
if(varname=='modified'&&!v){var v=(new Date(this.ctime*1000)).toGMTString().replace(/ GMT$/,'');this.modified=v;}
$j(el).text(v);};File.prototype.setThumbnailBackground=function(el,reset){var fsdata=window.kfm_incrementalFileDisplay_vars.data.sprites;var id=this.id;if(fsdata){css_sprite=[];for(var i=0;i<fsdata.length;++i)if(fsdata[i].files.indexOf(id)!=-1){el.style.backgroundImage='url("sprite.php?md5='+fsdata[i].sprite+'")';el.style.backgroundPosition=-64*fsdata[i].files.indexOf(id)+'px top';return;}}
el.style.background='url(get.php?id='+id+'&width=64&height=64'+kfm_vars.get_params+') center top no-repeat';}
File.prototype.iterateThumbnailQueue=function(){if(!File_ThumbnailsQueue.length){window.File_ThumbnailsTimeout=null;return;}
var el=window.File_ThumbnailsQueue[0][0],id=window.File_ThumbnailsQueue[0][1];if(el&&el.parentNode&&el.parentNode.id=='documents_body'){var url='get.php?id='+id+'&width=64&height=64'+kfm_vars.get_params;var img=document.createElement('img');img.src=url;img.style.width=1;img.style.height=1;$j.event.add(img,'load',function(){el.style.backgroundImage='url("'+url+'")';var F=File_getInstance(id);F.id=id;F.icon_loaded=1;F.icon_url=url;$j(this).remove();});setTimeout(File.prototype.iterateThumbnailQueue,1);kfm.addEl(el,img);}
else setTimeout(File.prototype.iterateThumbnailQueue,1);window.File_ThumbnailsQueue.shift();}
function File_getInstance(id,data){id=parseInt(id);if(isNaN(id))return;if(!File_Instances[id]||data){File_Instances[id]=new File();File_Instances[id].initialize(id,data);}
return File_Instances[id];}
function File_setData(el,F){var id=+el.id;if(!F)F=File_getInstance(id);$each(el,function(varvalue,varname){F[varname]=el[varname];if(!F.textInstances||!F.textInstances[varname])return;F.textInstances[varname].each(function(t){F.setText(t,varname);});});File_Instances[id]=F;}
var File_Instances=[];var File_ThumbnailsQueue=[];var kfm_file_bits={cacheableIcons:[],contextMenu:function(e){var el=e.target;while(el.parentNode&&!el.file_id)el=el.parentNode;if(!el.parentNode)return;if(selectedFiles.length>1)kfm_getLinks(selectedFiles);else kfm_getLinks([el.file_id]);},dragDisplay:function(){var i;window.dragAddedFileToSelection=false;if(!kfm_isFileSelected(this.file_id)){kfm_addToSelection(this.file_id);window.dragAddedFileToSelection=true;}
var drag_wrapper=document.createElement('div');drag_wrapper.id='kfm_drag_wrapper';drag_wrapper.style.minWidth='100px';drag_wrapper.style.opacity='.7';for(i=0;i<10&&i<selectedFiles.length;++i)kfm.addEl(drag_wrapper,[File_getInstance(selectedFiles[i]).name,document.createElement('br')]);if(selectedFiles.length>10){i=document.createElement('i');i.innerHTML=kfm.lang.AndNMore(selectedFiles.length-10);drag_wrapper.appendChild(i);}
return drag_wrapper;},dblclick:function(e)
{var el=e.target;while(!el.file_id&&el)
el=el.parentNode;if(!el)
return;var id=el.file_id;kfm_insertFile(id);},infoTooltipStart:function(e){if(window.kfm_tooltipInit)clearTimeout(window.kfm_tooltipInit);if(window.kdnd_dragging)return;window.kfm_tooltipInit=setTimeout('kfm_showToolTip('+e.target.file_id+')',1000);},infoTooltipStop:function(){if(window.kfm_tooltipInit)clearTimeout(window.kfm_tooltipInit);var o=document.getElementById('kfm_tooltip');if(o)o.parentNode.removeChild(o);},padding:0}
function kfm_fileLoader(ids){if($type(ids)!='array')ids=[ids];var i=0,l=ids.length,el;for(i=0;i<l;++i){el=document.getElementById('kfm_file_icon_'+ids[i]);el.style.backgroundImage='url(themes/'+kfm_theme+'/icons/64x64/loader.gif)';el.style.backgroundRepeat='no-repeat';el.style.backgroundLeft='center';}}
function kfm_filesLoader(){$j('<img src="themes/'+kfm_theme+'/small_loader.gif" alt=""/>').appendTo('#documents_loader');}
function kfm_files_reflowIcons(){var el,panel,els,k;panel=document.getElementById('documents_body');if(panel.contentMode!='file_icons')return;k=0;els=$j('#documents_body .kfm_file_icon');els.each(function(){if(!this)return;if(this.style.clear)this.style.clear='none';if(k&&els[k-1].offsetLeft>=this.offsetLeft)this.style.clear='left';++k;});kfm_show_number_of_files(k);kfm_setThumbnails();}
function kfm_setThumbnails(){var els,F,d,fold;fold=$j(window).height()+$j(window).scrollTop();els=$j('#documents_body .kfm_file_icon');els.each(function(){F=File_getInstance(this.file_id);if(F.width&&!this.icon_loaded&&fold>=getOffset(this,'Top')){F.setThumbnailBackground(this.imageHolder);}});}
function kfm_getCachedIcon(type){if(window.kfm_file_bits.cacheableIcons[type])return window.kfm_file_bits.cacheableIcons[type];var icon=document.createElement('div');icon.className='kfm_file '+(type?'kfm_file_listview':'kfm_file_icon');icon.style.cursor=window.ie?'hand':'pointer';window.kfm_file_bits.cacheableIcons[type]=icon;return icon;}
function kfm_isFileInCWD(id){var i,files=document.getElementById('documents_body').fileids;for(i=0;i<files.length;++i)if(files[i]==id)return true;return false;}
function kfm_incrementalFileDisplay(refresh_count){if(refresh_count!=kfm_vars.files.refresh_count){return;}
if(kfm_listview)kfm_incrementalFileDisplayListView();else kfm_incrementalFileDisplayIconView();}
function kfm_incrementalFileDisplayListView(){var a,b,fsdata,wrapper,fdata,name,F,el,id,prevEl;b=window.kfm_incrementalFileDisplay_vars;fsdata=b.data.files;wrapper=document.getElementById('documents_body');if(wrapper.contentMode!='file_icons')return(window.kfm_incrementalFileDisplay_vars=null);icon=kfm_getCachedIcon(kfm_listview);a=b.at;if(a)prevEl=document.getElementById('kfm_file_icon_'+fsdata[a-1].id);do{fdata=fsdata[a];name=fdata.name;id=fdata.id;F=File_getInstance(id,fdata);ext=fdata.ext;el=icon.cloneNode(true);el.id='kfm_file_icon_'+id;el.file_id=id;wrapper.files[a]=el;el.appendChild(F.getText('name'));var cs=0,cell;var listview_table=$j('#kfm_files_listview_table tbody').get(0);var rows=listview_table.rows.length;var row=listview_table.insertRow(rows);row.fileid=F.id;row.id='kfm_files_listview_table_row'+F.id;cell=row.insertCell(cs++);cell.className='listview_icon listview_icon_'+ext;cell.innerHTML='&nbsp;';row.insertCell(cs++).appendChild(el);{cell=row.insertCell(cs++);var hidden=document.createElement('span');hidden.style.display='none';hidden.appendChild(document.createTextNode(F.filesize_raw));cell.appendChild(hidden);cell.appendChild(F.getText('filesize'));}
row.insertCell(cs++).appendChild(F.getText('ext'));{cell=row.insertCell(cs++);var hidden=document.createElement('span');hidden.style.display='none';hidden.appendChild(document.createTextNode(F.ctime));cell.appendChild(hidden);cell.appendChild(F.getText('modified'));}
prevEl=el;++a;}while(a<fsdata.length);window.kfm_incrementalFileDisplay_vars.at=a;kdnd_makeDraggable('kfm_file');$j('#kfm_tooltip').remove();$j('#kfm_files_listview_table').columnSizing();$j('#kfm_files_listview_table').tablesorter({sortList:[[1,0]],headers:{1:{sorter:'kfmobject'}},widgets:['zebra']});$j('#documents_loader').html('&nbsp;');if(kfm_vars.startup_selectedFiles){for(var i=0;i<kfm_vars.startup_selectedFiles.length;++i)kfm_addToSelection(kfm_vars.startup_selectedFiles[i]);kfm_vars.startup_selectedFiles=false;}}
function kfm_incrementalFileDisplayIconView(){var a=0,b,fsdata,wrapper,fdata,name,F,el,id;b=window.kfm_incrementalFileDisplay_vars;fsdata=b.data.files;wrapper=document.getElementById('documents_body');wrapper.style.visibility='hidden';var buffer=document.createElement('div');if(wrapper.contentMode!='file_icons')return(window.kfm_incrementalFileDisplay_vars=null);icon=kfm_getCachedIcon(kfm_listview);do{fdata=fsdata[a];name=fdata.name;id=fdata.id;F=File_getInstance(id,fdata);ext=fdata.ext;el=icon.cloneNode(true);var img=document.createElement('span');img.className='img_holder';el.appendChild(img);el.imageHolder=img;el.id='kfm_file_icon_'+id;el.file_id=id;wrapper.files[a]=el;el.appendChild(F.getText('name'));el.className+=' kfm_icontype_'+ext;buffer.appendChild(el);++a;}while(a<fsdata.length);wrapper.appendChild(buffer);kdnd_makeDraggable('kfm_file');kfm_files_reflowIcons();$j('#documents_loader').html('&nbsp;');if(kfm_vars.startup_selectedFiles){for(var i=0;i<kfm_vars.startup_selectedFiles.length;++i)kfm_addToSelection(kfm_vars.startup_selectedFiles[i]);kfm_vars.startup_selectedFiles=false;}
wrapper.style.visibility='visible';}
function kfm_refreshFiles(res){if(!res.files)return;kfm_show_number_of_files(res.files.length);kdnd_addDropHandler('kfm_file','.kfm_directory_link',kfm_files_dragToDirectory);if(window.kfm_incrementalFileDisplay_loader){clearTimeout(window.kfm_incrementalFileDisplay_loader);window.kfm_incrementalFileDisplay_vars=null;}
kfm_selectNone();if(res.parent)kfm_cwd_id=res.parent;if(res.toString()===res)return;window.kfm_incrementalFileDisplay_vars={at:0,data:res};var a,b,lowest_name,lowest_index,s,wrapper;wrapper=document.getElementById('documents_body');wrapper.innerHTML='';$extend(wrapper,{contentMode:'file_icons',fileids:[],files:[]});document.getElementById('cwd_display').innerHTML=kfm.lang.CurrentWorkingDir(res.reqdir);{if(!res.files)res.files=[];for(a=0;a<res.files.length-1;++a){lowest_name=res.files[a].name;lowest_index=a;for(b=a+1;b<res.files.length;++b){if(res.files[b].name<lowest_name){lowest_index=b;lowest_name=res.files[b].name;}}
if(lowest_index!=a){b=res.files[a];res.files[a]=res.files[lowest_index];res.files[lowest_index]=b;}}}
for(a=0;a<res.files.length;++a)wrapper.fileids[a]=res.files[a].id;kfm_directories[kfm_cwd_id].hasChildren=res.files.length;document.title='KFM: '+res.reqdir;kfm_lastClicked=null;if(res.uploads_allowed)kfm_addPanel(document.getElementById('kfm_left_column'),'kfm_file_upload_panel');else kfm_removePanel('kfm_left_column','kfm_file_upload_panel');kfm_refreshPanels('kfm_left_column');if(!res.files.length){$j('#documents_loader').empty().html('&nbsp;');s=document.createElement('span');s.className='kfm_empty';s.innerHTML=kfm.lang.DirEmpty(res.reqdir);wrapper.appendChild(s);}else{if(kfm_listview){$j('<table id="kfm_files_listview_table" style="width:99%"><thead><tr class="listview_headers"><th>&nbsp;</th><th id="listview_headers_name">'+_('Name',0,0,1)+'</th><th id="listview_headers_size">'+_('Size',0,0,1)+'</th><th id="listview_headers_type">'+_('Type',0,0,1)+'</th><th id="listview_headers_lastmodified">'+_('Last Modified',0,0,1)+'</th></tr></thead><tbody></tbody></table>').appendTo(wrapper);}
kfm_vars.files.refresh_count++;kfm_incrementalFileDisplay(kfm_vars.files.refresh_count);}}
function kfm_show_number_of_files(num){$j('#folder_info').text(num+(num==1?' file':' files'));}
llStubs.push('kfm_deleteFile');llStubs.push('kfm_deleteFiles');llStubs.push('kfm_deleteSelectedFiles');llStubs.push('kfm_downloadFileFromUrl');llStubs.push('kfm_downloadSelectedFiles');llStubs.push('kfm_downloadSelectedFiles_addIframe');llStubs.push('kfm_files_dragToDirectory');llStubs.push('kfm_extractZippedFile');llStubs.push('kfm_removeFilesFromView');llStubs.push('kfm_renameFile');llStubs.push('kfm_renameFiles');llStubs.push('kfm_showToolTip');llStubs.push('kfm_zip');$j('.kfm_file').live('mouseover',function(e){if(!kfm_listview)window.kfm_file_bits.infoTooltipStart(e);if(this.hasActionEvents)return;$j.event.add(this,'click',kfm_toggleSelectedFile);$j.event.add(this,'dblclick',window.kfm_file_bits.dblclick);if(!kfm_listview)$j.event.add(this,'mouseout',window.kfm_file_bits.infoTooltipStop);kfm_addContextMenu(this,window.kfm_file_bits.contextMenu);this.hasActionEvents=true;this.dragDisplay=kfm_file_bits.dragDisplay;});function kfm_resizeHandler_addMaxHeight(name){if(kfm_resizeHandler_maxHeights.indexOf(name)==-1)kfm_resizeHandler_maxHeights.push(name);}
llStubs.push('kfm_resizeHandler');llStubs.push('kfm_resizeHandler_add');llStubs.push('kfm_resizeHandler_addMaxWidth');llStubs.push('kfm_resizeHandler_remove');llStubs.push('kfm_resizeHandler_removeMaxHeight');llStubs.push('kfm_resizeHandler_removeMaxWidth');var kfm_resizeHandler_maxHeights=[];var kfm_resizeHandler_maxWidths=[];function kfm_runSearch(){kfm_run_delayed('search',kfm_runSearch2);}
function kfm_searchBoxFile(){var sbox=document.createElement('input');sbox.id='kfm_search_keywords';$j.event.add(sbox,'keyup',kfm_runSearch);return sbox;}
llStubs.push('kfm_runSearch2');function lazyload_replace_stub(fname,js,ps){eval(js);(eval(fname)).apply(this,ps);}
var i,funcs=[],fname;for(i=0;i<llStubs.length;++i){fname=llStubs[i];funcs.push('window.'+fname+'=function(){var ps=arguments;x_kfm_getJsFunction("'+fname+'",function(js){lazyload_replace_stub("'+fname+'",js,ps);});};');}
eval(funcs.join("\n"));funcs=null;i=null;fname=null;